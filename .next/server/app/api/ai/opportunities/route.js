"use strict";(()=>{var e={};e.id=6407,e.ids=[6407],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4294:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>f,originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var a={};i.r(a),i.d(a,{GET:()=>d,dynamic:()=>p});var o=i(95419),r=i(69108),n=i(99678),l=i(19631),s=i(78070);let p="force-dynamic";async function d(){try{let e=await l._.cliente.findMany({include:{pedidos:{include:{itens:{include:{produto:!0}}},orderBy:{data:"desc"}}}}),t=await l._.produto.findMany({include:{fabrica:!0}}),i=[],a=new Date().getMonth();for(let o of e){if(0===o.pedidos.length)continue;let e=o.celular||o.telefone||"",r=o.pedidos.slice(0,10),n=r.filter(e=>new Date(e.data).getMonth()===a);r.some(e=>"50a199"===e.tabelaPreco)&&n.length>=3&&i.push({type:"upgrade",clienteId:o.id,clienteNome:o.nomeFantasia,clienteTelefone:e,description:`${n.length} pedidos este m\xeas na tabela 50-199. Sugerir migra\xe7\xe3o para 200-699.`,priority:"alta",actionLabel:"Propor Upgrade"});let l=new Set(r.flatMap(e=>e.itens.map(e=>e.produtoId))),s=new Set(r.flatMap(e=>e.itens.map(e=>e.produto.fabricaId))),p=t.filter(e=>s.has(e.fabricaId)&&!l.has(e.id));if(p.length>0){let t=p[0];i.push({type:"crossSell",clienteId:o.id,clienteNome:o.nomeFantasia,clienteTelefone:e,description:`Nunca comprou "${t.nome}" da ${t.fabrica.nome}. ${p.length} produtos dispon\xedveis.`,priority:"media",actionLabel:"Oferecer Produto"})}let d=o.pedidos.filter(e=>new Date(e.data).getMonth()===a),c=o.pedidos.length/12;d.length>1.5*c&&d.length<2*c&&i.push({type:"seasonal",clienteId:o.id,clienteNome:o.nomeFantasia,clienteTelefone:e,description:`Historicamente compra mais neste m\xeas. Momento ideal para contato.`,priority:"media",actionLabel:"Contatar Cliente"})}let o={alta:0,media:1,baixa:2};return i.sort((e,t)=>o[e.priority]-o[t.priority]),s.Z.json({opportunities:i.slice(0,20),summary:{total:i.length,upgrade:i.filter(e=>"upgrade"===e.type).length,crossSell:i.filter(e=>"crossSell"===e.type).length,seasonal:i.filter(e=>"seasonal"===e.type).length}})}catch(e){return console.error("Error fetching opportunities:",e),s.Z.json({error:"Failed to fetch opportunities"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/ai/opportunities/route",pathname:"/api/ai/opportunities",filename:"route",bundlePath:"app/api/ai/opportunities/route"},resolvedPagePath:"E:\\FRPlus\\frplus-web\\src\\app\\api\\ai\\opportunities\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:u,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:f,staticGenerationBailout:g}=c,y="/api/ai/opportunities/route";function b(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},19631:(e,t,i)=>{i.d(t,{_:()=>o});let a=require("@prisma/client"),o=globalThis.prisma??new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[1638,6206],()=>i(4294));module.exports=a})();