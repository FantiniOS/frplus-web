"use strict";(()=>{var e={};e.id=525,e.ids=[525],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},89955:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>h,originalPathname:()=>f,patchFetch:()=>I,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>g});var i={};a.r(i),a.d(i,{GET:()=>c,dynamic:()=>d});var l=a(95419),o=a(69108),n=a(99678),r=a(19631),s=a(78070);let d="force-dynamic";async function c(e){try{let{searchParams:t}=new URL(e.url),a=parseInt(t.get("days")||"15"),i=new Date;i.setDate(i.getDate()-a);let l=await r._.cliente.findMany({include:{pedidos:{orderBy:{data:"desc"},take:1,select:{data:!0,valorTotal:!0}},_count:{select:{pedidos:!0}}}}),o=await r._.pedido.groupBy({by:["clienteId"],_sum:{valorTotal:!0},_count:!0}),n=new Map(o.map(e=>[e.clienteId,{totalGasto:Number(e._sum.valorTotal)||0,totalPedidos:e._count}])),d=l.map(e=>{let t=e.pedidos[0],a=t?.data||null,i=a?Math.floor((Date.now()-new Date(a).getTime())/864e5):null,l=n.get(e.id)||{totalGasto:0,totalPedidos:0},o="verde";return null===i||i>=60?o="vermelho":i>=30?o="laranja":i>=15&&(o="amarelo"),{id:e.id,nomeFantasia:e.nomeFantasia,razaoSocial:e.razaoSocial,cidade:e.cidade,telefone:e.telefone,celular:e.celular,email:e.email,ultimaCompra:a?.toISOString()||null,diasInativo:i,totalGasto:l.totalGasto,totalPedidos:l.totalPedidos,alertLevel:o}}).filter(e=>null===e.diasInativo||e.diasInativo>=a).sort((e,t)=>null===e.diasInativo&&null===t.diasInativo?0:null===e.diasInativo?-1:null===t.diasInativo?1:t.diasInativo-e.diasInativo),c={total:d.length,vermelho:d.filter(e=>"vermelho"===e.alertLevel).length,laranja:d.filter(e=>"laranja"===e.alertLevel).length,amarelo:d.filter(e=>"amarelo"===e.alertLevel).length};return s.Z.json({clients:d,summary:c})}catch(e){return console.error("Error fetching inactive clients:",e),s.Z.json({error:"Failed to fetch inactive clients"},{status:500})}}let u=new l.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/ai/inactive-clients/route",pathname:"/api/ai/inactive-clients",filename:"route",bundlePath:"app/api/ai/inactive-clients/route"},resolvedPagePath:"E:\\FRPlus\\frplus-web\\src\\app\\api\\ai\\inactive-clients\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:v,serverHooks:m,headerHooks:h,staticGenerationBailout:g}=u,f="/api/ai/inactive-clients/route";function I(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:v})}},19631:(e,t,a)=>{a.d(t,{_:()=>l});let i=require("@prisma/client"),l=globalThis.prisma??new i.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[1638,6206],()=>a(89955));module.exports=i})();