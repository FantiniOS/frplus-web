"use strict";(()=>{var e={};e.id=3707,e.ids=[3707],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},96007:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>g,originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>b});var r={};a.r(r),a.d(r,{GET:()=>l,dynamic:()=>u});var o=a(95419),d=a(69108),i=a(99678),n=a(19631),s=a(78070);let u="force-dynamic";async function l(){try{let[e,t,a]=await Promise.all([n._.cliente.count(),n._.produto.count(),n._.pedido.count()]),r=await n._.pedido.aggregate({_sum:{valorTotal:!0}}),o=Number(r._sum.valorTotal)||0,d=await n._.pedido.findMany({take:5,orderBy:{data:"desc"},include:{cliente:!0}}),i=await n._.itemPedido.groupBy({by:["produtoId"],_sum:{quantidade:!0,total:!0},orderBy:{_sum:{total:"desc"}},take:5}),u=i.map(e=>e.produtoId),l=await n._.produto.findMany({where:{id:{in:u}}}),p=new Map(l.map(e=>[e.id,e.nome])),c=new Date;c.setDate(c.getDate()-30);let m=await n._.pedido.findMany({where:{data:{gte:c}},select:{data:!0,valorTotal:!0}}),h=new Map;return m.forEach(e=>{let t=e.data.toISOString().split("T")[0];h.set(t,(h.get(t)||0)+Number(e.valorTotal))}),s.Z.json({stats:{clients:e,products:t,orders:a,revenue:o},recentOrders:d.map(e=>({id:e.id,nomeCliente:e.cliente.nomeFantasia,data:e.data.toISOString(),valorTotal:Number(e.valorTotal),status:e.status})),topProducts:i.map(e=>({produtoId:e.produtoId,nome:p.get(e.produtoId)||"Unknown",quantidade:e._sum.quantidade||0,valor:Number(e._sum.total)||0})),salesByDay:Array.from(h.entries()).map(([e,t])=>({date:e,value:t}))})}catch(e){return console.error("Error fetching dashboard stats:",e),s.Z.json({error:"Failed to fetch dashboard stats"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:d.x.APP_ROUTE,page:"/api/dashboard/route",pathname:"/api/dashboard",filename:"route",bundlePath:"app/api/dashboard/route"},resolvedPagePath:"E:\\FRPlus\\frplus-web\\src\\app\\api\\dashboard\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:g,staticGenerationBailout:b}=p,v="/api/dashboard/route";function w(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},19631:(e,t,a)=>{a.d(t,{_:()=>o});let r=require("@prisma/client"),o=globalThis.prisma??new r.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[1638,6206],()=>a(96007));module.exports=r})();