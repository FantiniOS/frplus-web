"use strict";(()=>{var e={};e.id=3707,e.ids=[3707],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},96007:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>h,originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>g});var r={};a.r(r),a.d(r,{GET:()=>u});var o=a(95419),d=a(69108),s=a(99678),i=a(19631),n=a(78070);async function u(){try{let[e,t,a]=await Promise.all([i._.cliente.count(),i._.produto.count(),i._.pedido.count()]),r=await i._.pedido.aggregate({_sum:{valorTotal:!0}}),o=Number(r._sum.valorTotal)||0,d=await i._.pedido.findMany({take:5,orderBy:{data:"desc"},include:{cliente:!0}}),s=await i._.itemPedido.groupBy({by:["produtoId"],_sum:{quantidade:!0,total:!0},orderBy:{_sum:{total:"desc"}},take:5}),u=s.map(e=>e.produtoId),l=await i._.produto.findMany({where:{id:{in:u}}}),p=new Map(l.map(e=>[e.id,e.nome])),c=new Date;c.setDate(c.getDate()-30);let m=await i._.pedido.findMany({where:{data:{gte:c}},select:{data:!0,valorTotal:!0}}),h=new Map;return m.forEach(e=>{let t=e.data.toISOString().split("T")[0];h.set(t,(h.get(t)||0)+Number(e.valorTotal))}),n.Z.json({stats:{clients:e,products:t,orders:a,revenue:o},recentOrders:d.map(e=>({id:e.id,nomeCliente:e.cliente.nomeFantasia,data:e.data.toISOString(),valorTotal:Number(e.valorTotal),status:e.status})),topProducts:s.map(e=>({produtoId:e.produtoId,nome:p.get(e.produtoId)||"Unknown",quantidade:e._sum.quantidade||0,valor:Number(e._sum.total)||0})),salesByDay:Array.from(h.entries()).map(([e,t])=>({date:e,value:t}))})}catch(e){return console.error("Error fetching dashboard stats:",e),n.Z.json({error:"Failed to fetch dashboard stats"},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:d.x.APP_ROUTE,page:"/api/dashboard/route",pathname:"/api/dashboard",filename:"route",bundlePath:"app/api/dashboard/route"},resolvedPagePath:"E:\\FRPlus\\frplus-web\\src\\app\\api\\dashboard\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:m,headerHooks:h,staticGenerationBailout:g}=l,b="/api/dashboard/route";function v(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},19631:(e,t,a)=>{a.d(t,{_:()=>o});let r=require("@prisma/client"),o=globalThis.prisma??new r.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[1638,6206],()=>a(96007));module.exports=r})();