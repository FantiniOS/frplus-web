(()=>{var e={};e.id=3811,e.ids=[3811],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},67360:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>p,originalPathname:()=>x,pages:()=>c,routeModule:()=>u,tree:()=>d});var a=r(50482),s=r(69108),o=r(62563),l=r.n(o),i=r(68300),n={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>i[e]);r.d(t,n);let d=["",{children:["dashboard",{children:["pedidos",{children:["novo",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,91688)),"E:\\FRPlus\\frplus-web\\src\\app\\dashboard\\pedidos\\novo\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,94699)),"E:\\FRPlus\\frplus-web\\src\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,49342)),"E:\\FRPlus\\frplus-web\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\FRPlus\\frplus-web\\src\\app\\dashboard\\pedidos\\novo\\page.tsx"],x="/dashboard/pedidos/novo/page",p={require:r,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/dashboard/pedidos/novo/page",pathname:"/dashboard/pedidos/novo",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},29016:(e,t,r)=>{Promise.resolve().then(r.bind(r,66666))},63024:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},31498:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},28765:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},12401:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},18822:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(69224).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},66666:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(95344),s=r(63024),o=r(31498),l=r(47664),i=r(18822),n=r(28765),d=r(12401),c=r(66137),x=r(3729),p=r(8428),u=r(99119),h=r(87292);function m(){let{clients:e,products:t,addOrder:r,showToast:m,fabricas:b}=(0,c.e)(),g=(0,p.useRouter)(),[y,f]=(0,x.useState)("factory"),[j,w]=(0,x.useState)(""),[v,N]=(0,x.useState)(""),[C,P]=(0,x.useState)([]),[k,S]=(0,x.useState)(""),[q,_]=(0,x.useState)(new Date().toISOString().split("T")[0]),[I,Z]=(0,x.useState)("preco50a199"),[E,F]=(0,x.useState)("30 dias"),[L,R]=(0,x.useState)(""),[z,M]=(0,x.useState)(""),[A,D]=(0,x.useState)("all"),[$,B]=(0,x.useState)({}),U=b.find(e=>e.id===j),O=e.find(e=>e.id===v),T=async e=>{try{let t=await fetch(`/api/clients/${e}/product-history`);if(t.ok){let e=await t.json();B(e)}}catch(e){console.error("Error fetching price history:",e)}},V=e=>{w(e),f("client"),P([])},G=t=>{N(t);let r=e.find(e=>e.id===t);r?.tabelaPreco&&Z(r.tabelaPreco),T(t),f("order")},H=e=>Number(e[I]||e.preco50a199),J=e=>{let t=H(e);P(r=>r.find(t=>t.produtoId===e.id)?r.map(r=>r.produtoId===e.id?{...r,quantidade:r.quantidade+1,total:(r.quantidade+1)*t}:r):[...r,{produtoId:e.id,nomeProduto:e.nome,quantidade:1,precoUnitario:t,total:t}])},X=e=>{P(t=>{let r=t.find(t=>t.produtoId===e);return r&&r.quantidade>1?t.map(t=>t.produtoId===e?{...t,quantidade:t.quantidade-1,total:(t.quantidade-1)*t.precoUnitario}:t):t.filter(t=>t.produtoId!==e)})},K=(e,t)=>{if(!(t<0)){if(0===t){P(t=>t.filter(t=>t.produtoId!==e));return}P(r=>r.map(r=>r.produtoId===e?{...r,quantidade:t,total:t*r.precoUnitario}:r))}},Q=(0,x.useMemo)(()=>U?t.filter(e=>{let t=e.fabricaId===U.id,r=e.nome.toLowerCase().includes(L.toLowerCase())||e.codigo.toLowerCase().includes(L.toLowerCase()),a="all"===A||e.categoria===A;return t&&r&&a}):[],[t,U,L,A]),W=(0,x.useMemo)(()=>{if(!U)return[];let e=t.filter(e=>e.fabricaId===U.id).map(e=>e.categoria).filter(e=>!!e);return Array.from(new Set(e))},[t,U]),Y=(0,x.useMemo)(()=>e.filter(e=>e.nomeFantasia.toLowerCase().includes(z.toLowerCase())||e.razaoSocial.toLowerCase().includes(z.toLowerCase())||e.cnpj.includes(z)),[e,z]),ee=C.reduce((e,t)=>e+t.total,0),et=C.reduce((e,t)=>e+t.quantidade,0),er=async()=>{if(!v||0===C.length){m("Selecione um cliente e adicione itens.","error");return}try{await r({clienteId:v,nomeCliente:O?.nomeFantasia||"Cliente",fabricaId:j,data:new Date(q).toISOString(),status:"Pendente",valorTotal:ee,tabelaPreco:I,condicaoPagamento:E,observacoes:k,itens:C.map(e=>({produtoId:e.produtoId,nomeProduto:e.nomeProduto,quantidade:e.quantidade,precoUnitario:e.precoUnitario,total:e.total}))}),g.push("/dashboard/pedidos")}catch(e){console.error(e),m("Erro ao salvar pedido","error")}};return(0,a.jsxs)("div",{className:"min-h-screen bg-[#121214] text-white flex flex-col",children:[(0,a.jsxs)("header",{className:"h-16 border-b border-white/5 bg-[#121214] flex items-center justify-between px-4 sticky top-0 z-20",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:()=>{"order"===y?f("client"):"client"===y?f("factory"):g.back()},className:"p-2 hover:bg-white/5 rounded-full transition-colors",children:a.jsx(s.Z,{className:"w-5 h-5 text-gray-400"})}),(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-sm font-bold text-white uppercase tracking-wider",children:"factory"===y?"Nova Venda / Selecionar F\xe1brica":"client"===y?"Nova Venda / Selecionar Cliente":`Pedido: ${U?.nome}`}),"order"===y&&O&&a.jsx("p",{className:"text-xs text-blue-400 font-medium",children:O.nomeFantasia})]})]}),"order"===y&&(0,a.jsxs)("button",{onClick:er,disabled:0===C.length,className:"flex items-center gap-2 bg-green-600 hover:bg-green-500 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg text-sm font-bold transition-all shadow-lg shadow-green-900/20",children:[a.jsx(o.Z,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Finalizar"})]})]}),a.jsx("main",{className:"flex-1 overflow-hidden relative",children:(0,a.jsxs)(u.M,{mode:"wait",children:["factory"===y&&(0,a.jsxs)(h.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"p-6 max-w-4xl mx-auto",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:[a.jsx(l.Z,{className:"text-purple-400"}),"Escolha a F\xe1brica"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(e=>(0,a.jsxs)("button",{onClick:()=>V(e.id),className:"p-6 rounded-xl border border-white/10 bg-white/5 hover:bg-purple-600/20 hover:border-purple-500/50 transition-all group text-left",children:[a.jsx("h3",{className:"text-lg font-bold text-white group-hover:text-purple-400 mb-2",children:e.nome}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e.produtosCount||0," produtos"]})]},e.id))})]},"factory"),"client"===y&&(0,a.jsxs)(h.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"p-6 max-w-4xl mx-auto h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[a.jsx(i.Z,{className:"text-blue-400"}),"Selecione o Cliente"]}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(n.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Buscar por nome, raz\xe3o social ou CNPJ...",value:z,onChange:e=>M(e.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-xl py-3 pl-10 pr-4 text-white focus:outline-none focus:border-blue-500 transition-colors",autoFocus:!0})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:[Y.map(e=>(0,a.jsxs)("button",{onClick:()=>G(e.id),className:"w-full p-4 rounded-xl border border-white/5 bg-white/5 hover:bg-white/10 text-left transition-colors flex items-center justify-between group",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-bold text-white group-hover:text-blue-400 transition-colors",children:e.nomeFantasia}),a.jsx("p",{className:"text-xs text-gray-500 uppercase",children:e.razaoSocial}),a.jsx("p",{className:"text-xs text-gray-600 font-mono mt-1",children:e.cnpj})]}),(0,a.jsxs)("div",{className:"text-right text-xs text-gray-500",children:[(0,a.jsxs)("p",{children:[e.cidade,"/",e.estado]}),e.ultima_compra&&(0,a.jsxs)("p",{className:"mt-1",children:["\xdaltima compra: ",new Date(e.ultima_compra).toLocaleDateString()]})]})]},e.id)),0===Y.length&&a.jsx("div",{className:"text-center py-12 text-gray-500",children:"Nenhum cliente encontrado."})]})]},"client"),"order"===y&&(0,a.jsxs)(h.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex flex-col h-full lg:flex-row",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 bg-[#0d0d0e]",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-white/5 space-y-3",children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx(n.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),a.jsx("input",{type:"text",value:L,onChange:e=>R(e.target.value),placeholder:"Buscar produto por c\xf3digo ou nome...",className:"w-full bg-gray-800 border border-gray-700 rounded-lg py-2 pl-9 pr-4 text-sm text-white focus:outline-none focus:border-blue-500"})]}),(0,a.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-1 custom-scrollbar",children:[a.jsx("button",{onClick:()=>D("all"),className:`px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap transition-colors ${"all"===A?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:"Todos"}),W.map(e=>a.jsx("button",{onClick:()=>D(e),className:`px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap transition-colors ${A===e?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:e},e))]})]}),a.jsx("div",{className:"flex-1 overflow-auto custom-scrollbar",children:(0,a.jsxs)("table",{className:"w-full text-left border-collapse",children:[a.jsx("thead",{className:"bg-[#121214] sticky top-0 z-10 text-xs font-bold text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"px-4 py-3 border-b border-white/5",children:"Cod"}),a.jsx("th",{className:"px-4 py-3 border-b border-white/5 w-full",children:"Produto"}),a.jsx("th",{className:"px-4 py-3 border-b border-white/5 text-center hidden sm:table-cell",children:"Categ."}),a.jsx("th",{className:"px-4 py-3 border-b border-white/5 text-right w-[100px]",children:"Pre\xe7o"})]})}),a.jsx("tbody",{className:"divide-y divide-white/5",children:Q.map(e=>{let t=C.find(t=>t.produtoId===e.id),r=t?.quantidade||0,s=H(e),o=$[e.id];return(0,a.jsxs)("tr",{onClick:()=>J(e),className:`
                                                            group cursor-pointer transition-colors
                                                            ${r>0?"bg-blue-900/10 hover:bg-blue-900/20":"hover:bg-white/5"}
                                                        `,children:[a.jsx("td",{className:"px-4 py-3 text-xs text-gray-500 font-mono border-r border-white/5",children:e.codigo}),(0,a.jsxs)("td",{className:"px-4 py-3 border-r border-white/5",children:[a.jsx("div",{className:"font-medium text-gray-200 group-hover:text-white transition-colors",children:e.nome}),a.jsx("div",{className:"flex items-center gap-2 mt-1",children:o&&(0,a.jsxs)("span",{className:"text-[10px] bg-yellow-400/10 text-yellow-400 px-1.5 py-0.5 rounded border border-yellow-400/20",title:"\xdaltimo pre\xe7o pago",children:["\xdalt: ",o.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]})})]}),a.jsx("td",{className:"px-4 py-3 text-xs text-gray-500 text-center hidden sm:table-cell border-r border-white/5",children:e.categoria||"-"}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right",children:[a.jsx("div",{className:"text-sm font-medium text-gray-300",children:s.toLocaleString("pt-BR",{minimumFractionDigits:2})}),a.jsx("div",{className:"flex items-center justify-end gap-1mt-1",onClick:e=>e.stopPropagation(),children:r>0&&(0,a.jsxs)("div",{className:"flex items-center bg-gray-900 rounded-lg border border-gray-700 mt-1",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),X(e.id)},className:"w-7 h-7 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-700 rounded-l-lg",children:"-"}),a.jsx("input",{type:"number",value:r,onChange:t=>{let r=parseInt(t.target.value);isNaN(r)||K(e.id,r)},onClick:e=>e.stopPropagation(),className:"w-10 h-7 bg-transparent text-center text-sm font-bold text-blue-400 focus:outline-none appearance-none"}),a.jsx("button",{onClick:t=>{t.stopPropagation(),J(e)},className:"w-7 h-7 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-700 rounded-r-lg",children:"+"})]})})]})]},e.id)})})]})})]}),(0,a.jsxs)("div",{className:"w-full lg:w-[350px] bg-[#121214] border-t lg:border-t-0 lg:border-l border-white/10 flex flex-col z-20 shadow-2xl",children:[a.jsx("div",{className:"p-4 space-y-4 border-b border-white/5 bg-gray-900/50",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[a.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500",children:"Tabela de Pre\xe7o"}),(0,a.jsxs)("select",{value:I,onChange:e=>Z(e.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg text-xs px-3 py-2 text-white focus:border-blue-500 outline-none",children:[a.jsx("option",{value:"preco50a199",children:"Padr\xe3o"}),a.jsx("option",{value:"preco200a699",children:"200 a 699"}),a.jsx("option",{value:"atacado",children:"Atacado"}),a.jsx("option",{value:"atacadoAVista",children:"Atacado \xe0 Vista"}),a.jsx("option",{value:"redes",children:"Redes"})]})]}),(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[a.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500",children:"Condi\xe7\xe3o Pagto"}),(0,a.jsxs)("select",{value:E,onChange:e=>F(e.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg text-xs px-3 py-2 text-white focus:border-blue-500 outline-none",children:[a.jsx("option",{children:"A Vista"}),a.jsx("option",{children:"30 Dias"}),a.jsx("option",{children:"30/60 Dias"}),a.jsx("option",{children:"30/60/90 Dias"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500",children:"Data Emiss\xe3o"}),a.jsx("input",{type:"date",value:q,onChange:e=>_(e.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg text-xs px-3 py-2 text-white focus:border-blue-500 outline-none"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500",children:"Observa\xe7\xf5es"}),a.jsx("textarea",{rows:2,value:k,onChange:e=>S(e.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg text-xs px-3 py-2 text-white resize-none focus:border-blue-500 outline-none",placeholder:"Obs. do pedido..."})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 bg-[#0f0f10]",children:0===C.length?(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-gray-600 space-y-2",children:[a.jsx(d.Z,{className:"w-8 h-8 opacity-20"}),a.jsx("p",{className:"text-xs",children:"Carrinho vazio"})]}):C.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 rounded bg-white/5 border border-white/5 text-xs",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0 pr-2",children:[a.jsx("p",{className:"font-medium text-gray-300 truncate",children:e.nomeProduto}),(0,a.jsxs)("p",{className:"text-gray-500",children:[e.quantidade," x R$ ",e.precoUnitario.toFixed(2)]})]}),a.jsx("div",{className:"text-right",children:(0,a.jsxs)("p",{className:"font-bold text-white",children:["R$ ",e.total.toFixed(2)]})})]},t))}),(0,a.jsxs)("div",{className:"p-4 bg-gray-900 border-t border-white/10",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[a.jsx("span",{className:"text-xs text-gray-400",children:"Itens"}),a.jsx("span",{className:"text-sm font-mono text-white",children:et})]}),(0,a.jsxs)("div",{className:"flex justify-between items-end",children:[a.jsx("span",{className:"text-sm font-bold text-gray-400",children:"TOTAL"}),a.jsx("span",{className:"text-2xl font-bold text-green-400",children:ee.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]})]})]})]},"order")]})})]})}},91688:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>o,__esModule:()=>s,default:()=>l});let a=(0,r(86843).createProxy)(String.raw`E:\FRPlus\frplus-web\src\app\dashboard\pedidos\novo\page.tsx`),{__esModule:s,$$typeof:o}=a,l=a.default}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,995,9065,100,6484],()=>r(67360));module.exports=a})();