(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[32],{66322:function(e,t,a){Promise.resolve().then(a.bind(a,15282))},15282:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var r=a(3827),i=a(64090),s=a(5590),o=a(36619),l=a(63915),n=a(29733),c=a(4697),d=a(34059),x=a(48219),h=a(69475),m=a(22071),p=a(85159),g=a(23441),u=a(67366),b=a(38371);function y(){let{orders:e,clients:t,products:y,fabricas:f,refreshData:j}=(0,s.e)();(0,i.useEffect)(()=>{j()},[j]);let[v,N]=(0,i.useState)("vendas"),[w,S]=(0,i.useState)((()=>{let e=new Date;return e.setMonth(e.getMonth()-1),e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e.toISOString().split("T")[0]})()),[C,T]=(0,i.useState)((()=>{let e=new Date;return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e.toISOString().split("T")[0]})()),[R,F]=(0,i.useState)(!1),[P,k]=(0,i.useState)("todas"),[E,D]=(0,i.useState)("todas"),[O,z]=(0,i.useState)(null),$=(0,i.useRef)(null),I=(0,i.useMemo)(()=>e.filter(e=>{let t=new Date(e.data),a=new Date(w+"T00:00:00"),r=new Date(C+"T23:59:59");return t>=a&&t<=r}),[e,w,C]),L=(0,i.useMemo)(()=>{let e=I.reduce((e,t)=>e+t.valorTotal,0),t=I.length;return{totalVendas:e,totalPedidos:t,ticketMedio:t>0?e/t:0,vendasPorDia:I.reduce((e,t)=>{let a=new Date(t.data).toLocaleDateString("pt-BR");return e[a]=(e[a]||0)+t.valorTotal,e},{})}},[I]),A=(0,i.useMemo)(()=>{let e=new Map;return I.forEach(t=>{t.itens.forEach(t=>{let a=e.get(t.produtoId)||{nome:t.nomeProduto,qtd:0,valor:0};e.set(t.produtoId,{nome:t.nomeProduto,qtd:a.qtd+t.quantidade,valor:a.valor+t.total})})}),Array.from(e.values()).sort((e,t)=>t.valor-e.valor)},[I]),V=(0,i.useMemo)(()=>{let e=new Map;return I.forEach(t=>{let a=e.get(t.clienteId)||{nome:t.nomeCliente,pedidos:0,valor:0};e.set(t.clienteId,{nome:t.nomeCliente,pedidos:a.pedidos+1,valor:a.valor+t.valorTotal})}),Array.from(e.values()).sort((e,t)=>t.valor-e.valor)},[I]),B=async()=>{F(!0);try{let t=(await Promise.all([a.e(125),a.e(505),a.e(232)]).then(a.bind(a,92493))).default,r=(await a.e(896).then(a.bind(a,25264))).default,i=new t({orientation:"tabela"===v?"portrait":"landscape",unit:"mm",format:"a4"}),s=i.internal.pageSize.getWidth(),o=[37,99,235];i.setFillColor(13,13,13),i.rect(0,0,s,40,"F");try{let e=new Image;e.crossOrigin="anonymous",await new Promise(t=>{e.onload=()=>{let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let r=a.getContext("2d");null==r||r.drawImage(e,0,0);let s=a.toDataURL("image/png"),o=25,l=e.width/e.height*o;l>50&&(l=50,o=e.height/e.width*l),i.addImage(s,"PNG",10,7.5,l,o),t()},e.onerror=()=>t(),e.src="/logo.png"})}catch(e){}i.setTextColor(255,255,255),i.setFontSize(22),i.setFont("helvetica","bold"),i.text("FRPlus",s/2,15,{align:"center"}),i.setFontSize(10),i.setFont("helvetica","normal"),i.setTextColor(180,180,180),i.text("Sistema de Gest\xe3o Comercial",s/2,20,{align:"center"});let l={vendas:"Relat\xf3rio de Vendas",produtos:"Ranking de Produtos",clientes:"Ranking de Clientes",tabela:"Tabela de Pre\xe7os"};i.setTextColor(255,255,255),i.setFontSize(14),i.setFont("helvetica","bold"),i.text(l[v],s/2,30,{align:"center"}),i.setFontSize(8),i.setFont("helvetica","normal"),i.setTextColor(180,180,180),i.text("".concat(new Date().toLocaleDateString("pt-BR")),s-10,12,{align:"right"}),i.text("".concat(new Date().toLocaleTimeString("pt-BR")),s-10,16,{align:"right"}),"tabela"!==v&&(i.text("Per\xedodo:",s-10,24,{align:"right"}),i.text("".concat(new Date(w).toLocaleDateString("pt-BR")," a ").concat(new Date(C).toLocaleDateString("pt-BR")),s-10,28,{align:"right"}));let n=45;if(i.setTextColor(30,30,30),"vendas"===v)i.setFontSize(11),i.setFont("helvetica","bold"),i.text("Total Vendas: R$ ".concat(L.totalVendas.toLocaleString("pt-BR",{minimumFractionDigits:2})),15,n),i.text("Pedidos: ".concat(L.totalPedidos),100,n),i.text("Ticket M\xe9dio: R$ ".concat(L.ticketMedio.toLocaleString("pt-BR",{minimumFractionDigits:2})),150,n),n+=10,r(i,{startY:n,head:[["Pedido","Cliente","Data","Itens","Valor"]],body:I.map(e=>["#".concat(e.id.slice(-6)),e.nomeCliente,new Date(e.data).toLocaleDateString("pt-BR"),e.itens.length.toString(),"R$ ".concat(e.valorTotal.toLocaleString("pt-BR",{minimumFractionDigits:2}))]),styles:{fontSize:9,cellPadding:3,halign:"center",valign:"middle"},headStyles:{fillColor:o,textColor:255,halign:"center"},columnStyles:{0:{halign:"left"},1:{halign:"left"},4:{halign:"right"}},alternateRowStyles:{fillColor:[245,247,250]},margin:{top:10,left:10,right:10}});else if("produtos"===v)r(i,{startY:n,head:[["#","Produto","Quantidade Vendida","Valor Total"]],body:A.map((e,t)=>[(t+1).toString(),e.nome,e.qtd.toString(),"R$ ".concat(e.valor.toLocaleString("pt-BR",{minimumFractionDigits:2}))]),styles:{fontSize:9,cellPadding:3,halign:"center"},headStyles:{fillColor:o,textColor:255},columnStyles:{1:{halign:"left"},3:{halign:"right"}},alternateRowStyles:{fillColor:[245,247,250]},foot:[["","TOTAL",A.reduce((e,t)=>e+t.qtd,0).toString(),"R$ ".concat(A.reduce((e,t)=>e+t.valor,0).toLocaleString("pt-BR",{minimumFractionDigits:2}))]],footStyles:{fillColor:[30,30,30],textColor:255,fontStyle:"bold",halign:"right"},margin:{top:10,left:10,right:10}});else if("clientes"===v)r(i,{startY:n,head:[["#","Cliente","Pedidos","Valor Total"]],body:V.map((e,t)=>[(t+1).toString(),e.nome,e.pedidos.toString(),"R$ ".concat(e.valor.toLocaleString("pt-BR",{minimumFractionDigits:2}))]),styles:{fontSize:9,cellPadding:3,halign:"center"},headStyles:{fillColor:o,textColor:255},columnStyles:{1:{halign:"left"},3:{halign:"right"}},alternateRowStyles:{fillColor:[245,247,250]},foot:[["","TOTAL",V.reduce((e,t)=>e+t.pedidos,0).toString(),"R$ ".concat(V.reduce((e,t)=>e+t.valor,0).toLocaleString("pt-BR",{minimumFractionDigits:2}))]],footStyles:{fillColor:[30,30,30],textColor:255,fontStyle:"bold",halign:"right"},margin:{top:10,left:10,right:10}});else if("tabela"===v){"todas"!==P&&(i.setFontSize(11),i.setFont("helvetica","bold"),i.text("Tabela: ".concat({todas:"Todas as Tabelas","50a199":"50 a 199 unidades","200a699":"200 a 699 unidades",atacado:"Atacado",avista:"Atacado \xc0 Vista",redes:"Redes"}[P]),15,n),n+=8);let t=y.filter(e=>"todas"===E||("sem-fabrica"===E?!e.fabricaId:e.fabricaId===E)).reduce((e,t)=>{let a=t.fabricaId||"sem-fabrica";return e[a]||(e[a]=[]),e[a].push(t),e},{});for(let a of Object.keys(t).sort((e,t)=>{var a,r;let i="sem-fabrica"===e?"Outros":(null===(a=f.find(t=>t.id===e))||void 0===a?void 0:a.nome)||"Outros",s="sem-fabrica"===t?"Outros":(null===(r=f.find(e=>e.id===t))||void 0===r?void 0:r.nome)||"Outros";return"sem-fabrica"===e?1:"sem-fabrica"===t?-1:i.localeCompare(s)})){var e;let l=t[a],c="sem-fabrica"===a?"OUTROS":((null===(e=f.find(e=>e.id===a))||void 0===e?void 0:e.nome)||"OUTROS").toUpperCase();n>i.internal.pageSize.getHeight()-40&&(i.addPage(),n=20),i.setFillColor(240,240,240),i.rect(14,n,s-28,8,"F"),i.setFontSize(10),i.setFont("helvetica","bold"),i.setTextColor(50,50,50),i.text(c,16,n+5.5),n+=8;let d=[],x=[];"todas"===P?(d=[["C\xf3digo","Produto","50-199","200-699","Atacado","\xc0 Vista","Redes"]],x=l.map(e=>{var t,a,r,i,s;return[e.codigo,e.nome,"R$ ".concat((null===(t=e.preco50a199)||void 0===t?void 0:t.toFixed(2))||"0.00"),"R$ ".concat((null===(a=e.preco200a699)||void 0===a?void 0:a.toFixed(2))||"0.00"),"R$ ".concat((null===(r=e.precoAtacado)||void 0===r?void 0:r.toFixed(2))||"0.00"),"R$ ".concat((null===(i=e.precoAtacadoAVista)||void 0===i?void 0:i.toFixed(2))||"0.00"),"R$ ".concat((null===(s=e.precoRedes)||void 0===s?void 0:s.toFixed(2))||"0.00")]})):(d=[["C\xf3digo","Produto","Pre\xe7o"]],x=l.map(e=>{var t,a,r,i,s;let o="0.00";return"50a199"===P?o=(null===(t=e.preco50a199)||void 0===t?void 0:t.toFixed(2))||"0.00":"200a699"===P?o=(null===(a=e.preco200a699)||void 0===a?void 0:a.toFixed(2))||"0.00":"atacado"===P?o=(null===(r=e.precoAtacado)||void 0===r?void 0:r.toFixed(2))||"0.00":"avista"===P?o=(null===(i=e.precoAtacadoAVista)||void 0===i?void 0:i.toFixed(2))||"0.00":"redes"===P&&(o=(null===(s=e.precoRedes)||void 0===s?void 0:s.toFixed(2))||"0.00"),[e.codigo,e.nome,"R$ ".concat(o)]})),r(i,{startY:n,head:d,body:x,styles:{fontSize:8,cellPadding:2,valign:"middle",halign:"center"},headStyles:{fillColor:o,textColor:255,halign:"center"},alternateRowStyles:{fillColor:[255,255,255]},margin:{top:10,left:14,right:14},columnStyles:"todas"===P?{0:{cellWidth:20,halign:"left"},1:{cellWidth:"auto",halign:"left"}}:{0:{cellWidth:20,halign:"left"},1:{cellWidth:"auto",halign:"left"},2:{cellWidth:30,halign:"right"}}}),n=i.lastAutoTable.finalY+10}}let c=i.getNumberOfPages();for(let e=1;e<=c;e++)i.setPage(e),i.setFontSize(8),i.setTextColor(150,150,150),i.text("P\xe1gina ".concat(e," de ").concat(c),s/2,i.internal.pageSize.getHeight()-10,{align:"center"}),i.text("FRPlus - Sistema de Gest\xe3o Comercial",15,i.internal.pageSize.getHeight()-10);let d="".concat(l[v].replace(/ /g,"_"),"_").concat(new Date().toISOString().split("T")[0],".pdf");i.save(d)}catch(e){console.error("Erro ao exportar PDF:",e)}F(!1)};return(0,r.jsxs)("div",{className:"space-y-5 print:bg-white print:text-black",children:[(0,r.jsxs)("div",{className:"flex flex-col justify-between gap-4 md:flex-row md:items-center print:hidden",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Relat\xf3rios"}),(0,r.jsxs)("p",{className:"text-sm text-gray-400",children:[e.length," pedidos no sistema â€¢ ",I.length," no per\xedodo selecionado"]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("button",{onClick:B,disabled:R,className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 font-medium text-white hover:bg-green-500 transition-all shadow-lg shadow-green-600/20 disabled:opacity-50",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4"}),R?"Gerando...":"Exportar PDF"]}),(0,r.jsxs)("button",{onClick:()=>{window.print()},className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 font-medium text-white hover:bg-blue-500 transition-all shadow-lg shadow-blue-600/20",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),"Imprimir"]})]})]}),(0,r.jsx)("div",{className:"form-card print:hidden",children:(0,r.jsxs)("div",{className:"flex flex-wrap items-end gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label-compact",children:"Tipo de Relat\xf3rio"}),(0,r.jsx)("div",{className:"flex gap-1 p-1 rounded-lg bg-white/5 border border-white/10",children:[{id:"vendas",label:"Vendas",icon:n.Z},{id:"produtos",label:"Produtos",icon:c.Z},{id:"clientes",label:"Clientes",icon:d.Z},{id:"tabela",label:"Tabela de Pre\xe7os",icon:x.Z}].map(e=>(0,r.jsxs)("button",{onClick:()=>N(e.id),className:"px-3 py-1.5 text-xs font-medium rounded-md transition-all flex items-center gap-1 ".concat(v===e.id?"bg-blue-600 text-white":"text-gray-400 hover:text-white"),children:[(0,r.jsx)(e.icon,{className:"h-3 w-3"}),e.label]},e.id))})]}),"tabela"!==v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label-compact",children:"Per\xedodo In\xedcio"}),(0,r.jsx)("input",{type:"date",value:w,onChange:e=>S(e.target.value),className:"input-compact"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label-compact",children:"Per\xedodo Fim"}),(0,r.jsx)("input",{type:"date",value:C,onChange:e=>T(e.target.value),className:"input-compact"})]})]}),"tabela"===v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label-compact",children:"Tabela para Exportar"}),(0,r.jsxs)("select",{value:P,onChange:e=>k(e.target.value),className:"input-compact",children:[(0,r.jsx)("option",{value:"todas",children:"Todas as Tabelas"}),(0,r.jsx)("option",{value:"50a199",children:"50 a 199 unidades"}),(0,r.jsx)("option",{value:"200a699",children:"200 a 699 unidades"}),(0,r.jsx)("option",{value:"atacado",children:"Atacado"}),(0,r.jsx)("option",{value:"avista",children:"Atacado \xc0 Vista"}),(0,r.jsx)("option",{value:"redes",children:"Redes"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label-compact",children:"Filtrar por F\xe1brica"}),(0,r.jsxs)("select",{value:E,onChange:e=>D(e.target.value),className:"input-compact",children:[(0,r.jsx)("option",{value:"todas",children:"Todas as F\xe1bricas"}),f.sort((e,t)=>e.nome.localeCompare(t.nome)).map(e=>(0,r.jsx)("option",{value:e.id,children:e.nome},e.id)),(0,r.jsx)("option",{value:"sem-fabrica",children:"Sem F\xe1brica Definida"})]})]})]})]})}),(0,r.jsxs)("div",{ref:$,className:"bg-[#0d0d0d] print:bg-white",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 print:grid-cols-4",children:[(0,r.jsx)("div",{className:"form-card",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 rounded-lg bg-green-500/10",children:(0,r.jsx)(x.Z,{className:"h-5 w-5 text-green-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-400",children:"Total Vendas"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-white print:text-black",children:["R$ ",L.totalVendas.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})]})}),(0,r.jsx)("div",{className:"form-card",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 rounded-lg bg-blue-500/10",children:(0,r.jsx)(h.Z,{className:"h-5 w-5 text-blue-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-400",children:"Pedidos"}),(0,r.jsx)("p",{className:"text-xl font-bold text-white print:text-black",children:L.totalPedidos})]})]})}),(0,r.jsx)("div",{className:"form-card",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 rounded-lg bg-purple-500/10",children:(0,r.jsx)(m.Z,{className:"h-5 w-5 text-purple-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-400",children:"Ticket M\xe9dio"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-white print:text-black",children:["R$ ",L.ticketMedio.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})]})}),(0,r.jsx)("div",{className:"form-card",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 rounded-lg bg-orange-500/10",children:(0,r.jsx)(d.Z,{className:"h-5 w-5 text-orange-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-400",children:"Clientes Ativos"}),(0,r.jsx)("p",{className:"text-xl font-bold text-white print:text-black",children:V.length})]})]})})]}),"vendas"===v&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"form-card",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white print:text-black mb-4",children:"Vendas por Dia"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"border-b border-white/10 print:border-gray-300",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left py-2 text-gray-400 print:text-gray-600",children:"Data"}),(0,r.jsx)("th",{className:"text-right py-2 text-gray-400 print:text-gray-600",children:"Valor"})]})}),(0,r.jsx)("tbody",{children:Object.entries(L.vendasPorDia).sort((e,t)=>new Date(t[0].split("/").reverse().join("-")).getTime()-new Date(e[0].split("/").reverse().join("-")).getTime()).map(e=>{let[t,a]=e;return(0,r.jsxs)("tr",{className:"border-b border-white/5 print:border-gray-200",children:[(0,r.jsx)("td",{className:"py-2 text-white print:text-black",children:t}),(0,r.jsxs)("td",{className:"py-2 text-right text-green-400 print:text-green-600 font-medium",children:["R$ ",a.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]},t)})})]})})]}),(0,r.jsxs)("div",{className:"form-card",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white print:text-black mb-4",children:"Detalhamento de Pedidos"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"border-b border-white/10 print:border-gray-300",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left py-2 text-gray-400 print:text-gray-600",children:"Pedido"}),(0,r.jsx)("th",{className:"text-left py-2 text-gray-400 print:text-gray-600",children:"Cliente"}),(0,r.jsx)("th",{className:"text-left py-2 text-gray-400 print:text-gray-600",children:"Data"}),(0,r.jsx)("th",{className:"text-center py-2 text-gray-400 print:text-gray-600",children:"Itens"}),(0,r.jsx)("th",{className:"text-right py-2 text-gray-400 print:text-gray-600",children:"Valor"})]})}),(0,r.jsx)("tbody",{children:I.sort((e,t)=>new Date(t.data).getTime()-new Date(e.data).getTime()).map(e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("tr",{className:"border-b border-white/5 print:border-gray-200 cursor-pointer hover:bg-white/5 transition-colors",onClick:()=>z(O===e.id?null:e.id),children:[(0,r.jsx)("td",{className:"py-2 font-mono text-white print:text-black",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[O===e.id?(0,r.jsx)(p.Z,{size:14,className:"text-gray-400"}):(0,r.jsx)(g.Z,{size:14,className:"text-gray-400"}),"#",e.id.slice(-6)]})}),(0,r.jsx)("td",{className:"py-2 text-white print:text-black",children:e.nomeCliente}),(0,r.jsx)("td",{className:"py-2 text-gray-400 print:text-gray-600",children:new Date(e.data).toLocaleDateString("pt-BR")}),(0,r.jsx)("td",{className:"py-2 text-center text-gray-400 print:text-gray-600",children:e.itens.length}),(0,r.jsx)("td",{className:"py-2 text-right text-green-400 print:text-green-600 font-medium",children:(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,r.jsxs)("span",{children:["R$ ",e.valorTotal.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),(0,r.jsx)("button",{onClick:a=>{var r;a.stopPropagation();let i=(null===(r=t.find(t=>t.id===e.clienteId))||void 0===r?void 0:r.celular)||"";if(!i){alert("Cliente sem celular cadastrado");return}let s="Ol\xe1 *".concat(e.nomeCliente,"*, segue o resumo do seu pedido *#").concat(e.id.slice(-6),"*:\n\n")+e.itens.map(e=>"- ".concat(e.quantidade,"x ").concat(e.nomeProduto," (R$ ").concat(e.total.toFixed(2),")")).join("\n")+"\n\n*Total: R$ ".concat(e.valorTotal.toFixed(2),"*"),o=i.replace(/\D/g,"");fetch("/api/whatsapp/send-text",{method:"POST",body:JSON.stringify({phone:"55"+o,message:s})}).then(async e=>{e.ok?alert("Mensagem enviada via Evolution API!"):(window.open("https://wa.me/55".concat(o,"?text=").concat(encodeURIComponent(s)),"_blank"),alert("Erro na API, abrindo WhatsApp Web..."))})},className:"p-1 rounded bg-green-600/20 text-green-400 hover:bg-green-600 hover:text-white transition-colors",title:"Enviar no WhatsApp",children:(0,r.jsx)(u.Z,{size:14})})]})})]},e.id),O===e.id&&(0,r.jsx)("tr",{className:"bg-white/5 print:bg-gray-50",children:(0,r.jsx)("td",{colSpan:5,className:"p-0",children:(0,r.jsx)(b.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"p-4",children:(0,r.jsxs)("div",{className:"bg-black/20 print:bg-white rounded-lg p-3 border border-white/10 print:border-gray-200",children:[(0,r.jsxs)("p",{className:"text-sm font-semibold text-white print:text-black mb-2 flex items-center gap-2",children:[(0,r.jsx)(c.Z,{size:14,className:"text-blue-400"}),"Itens do Pedido"]}),(0,r.jsxs)("table",{className:"w-full text-xs",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"text-gray-400 print:text-gray-600 border-b border-white/10 print:border-gray-200",children:[(0,r.jsx)("th",{className:"text-left py-2 font-medium",children:"Produto"}),(0,r.jsx)("th",{className:"text-center py-2 font-medium",children:"Qtd"}),(0,r.jsx)("th",{className:"text-right py-2 font-medium",children:"Unit\xe1rio"}),(0,r.jsx)("th",{className:"text-right py-2 font-medium",children:"Total"})]})}),(0,r.jsx)("tbody",{children:e.itens.map(e=>(0,r.jsxs)("tr",{className:"border-b border-white/5 print:border-gray-100 last:border-0",children:[(0,r.jsx)("td",{className:"py-2 text-white print:text-black",children:e.nomeProduto}),(0,r.jsx)("td",{className:"py-2 text-center text-gray-300 print:text-gray-700",children:e.quantidade}),(0,r.jsxs)("td",{className:"py-2 text-right text-gray-300 print:text-gray-700",children:["R$ ",e.precoUnitario.toFixed(2)]}),(0,r.jsxs)("td",{className:"py-2 text-right text-green-400 print:text-green-600 font-medium",children:["R$ ",e.total.toFixed(2)]})]},e.id||e.produtoId))})]})]})})})})]}))})]})})]})]}),"produtos"===v&&(0,r.jsxs)("div",{className:"form-card",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white print:text-black mb-4",children:"Ranking de Produtos"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"border-b border-white/10 print:border-gray-300",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left py-2 text-gray-400 print:text-gray-600",children:"#"}),(0,r.jsx)("th",{className:"text-left py-2 text-gray-400 print:text-gray-600",children:"Produto"}),(0,r.jsx)("th",{className:"text-center py-2 text-gray-400 print:text-gray-600",children:"Qtd Vendida"}),(0,r.jsx)("th",{className:"text-right py-2 text-gray-400 print:text-gray-600",children:"Valor Total"})]})}),(0,r.jsx)("tbody",{children:A.map((e,t)=>(0,r.jsxs)("tr",{className:"border-b border-white/5 print:border-gray-200",children:[(0,r.jsx)("td",{className:"py-2 text-gray-500",children:t+1}),(0,r.jsx)("td",{className:"py-2 text-white print:text-black font-medium",children:e.nome}),(0,r.jsx)("td",{className:"py-2 text-center text-gray-400 print:text-gray-600",children:e.qtd}),(0,r.jsxs)("td",{className:"py-2 text-right text-green-400 print:text-green-600 font-medium",children:["R$ ",e.valor.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]},e.nome))}),(0,r.jsx)("tfoot",{className:"border-t border-white/20 print:border-gray-400",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{colSpan:2,className:"py-2 font-bold text-white print:text-black",children:"Total"}),(0,r.jsx)("td",{className:"py-2 text-center font-bold text-white print:text-black",children:A.reduce((e,t)=>e+t.qtd,0)}),(0,r.jsxs)("td",{className:"py-2 text-right font-bold text-green-400 print:text-green-600",children:["R$ ",A.reduce((e,t)=>e+t.valor,0).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})})]})})]}),"clientes"===v&&(0,r.jsxs)("div",{className:"form-card",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white print:text-black mb-4",children:"Ranking de Clientes"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"border-b border-white/10 print:border-gray-300",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left py-2 text-gray-400 print:text-gray-600",children:"#"}),(0,r.jsx)("th",{className:"text-left py-2 text-gray-400 print:text-gray-600",children:"Cliente"}),(0,r.jsx)("th",{className:"text-center py-2 text-gray-400 print:text-gray-600",children:"Pedidos"}),(0,r.jsx)("th",{className:"text-right py-2 text-gray-400 print:text-gray-600",children:"Valor Total"})]})}),(0,r.jsx)("tbody",{children:V.map((e,t)=>(0,r.jsxs)("tr",{className:"border-b border-white/5 print:border-gray-200",children:[(0,r.jsx)("td",{className:"py-2 text-gray-500",children:t+1}),(0,r.jsx)("td",{className:"py-2 text-white print:text-black font-medium",children:e.nome}),(0,r.jsx)("td",{className:"py-2 text-center text-gray-400 print:text-gray-600",children:e.pedidos}),(0,r.jsxs)("td",{className:"py-2 text-right text-green-400 print:text-green-600 font-medium",children:["R$ ",e.valor.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]},e.nome))}),(0,r.jsx)("tfoot",{className:"border-t border-white/20 print:border-gray-400",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{colSpan:2,className:"py-2 font-bold text-white print:text-black",children:"Total"}),(0,r.jsx)("td",{className:"py-2 text-center font-bold text-white print:text-black",children:V.reduce((e,t)=>e+t.pedidos,0)}),(0,r.jsxs)("td",{className:"py-2 text-right font-bold text-green-400 print:text-green-600",children:["R$ ",V.reduce((e,t)=>e+t.valor,0).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})})]})})]}),"tabela"===v&&(0,r.jsx)("div",{className:"space-y-8",children:(()=>{let e=y.filter(e=>"todas"===E||("sem-fabrica"===E?!e.fabricaId:e.fabricaId===E)).reduce((e,t)=>{let a=t.fabricaId||"sem-fabrica";return e[a]||(e[a]=[]),e[a].push(t),e},{});return Object.keys(e).sort((e,t)=>{var a,r;let i="sem-fabrica"===e?"Outros":(null===(a=f.find(t=>t.id===e))||void 0===a?void 0:a.nome)||"Outros",s="sem-fabrica"===t?"Outros":(null===(r=f.find(e=>e.id===t))||void 0===r?void 0:r.nome)||"Outros";return"sem-fabrica"===e?1:"sem-fabrica"===t?-1:i.localeCompare(s)}).map(t=>{var a;let i=e[t],s="sem-fabrica"===t?"Outros":(null===(a=f.find(e=>e.id===t))||void 0===a?void 0:a.nome)||"Outros";return(0,r.jsxs)("div",{className:"form-card break-inside-avoid",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-4 print:mb-2",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-white print:text-black uppercase tracking-wider",children:s}),(0,r.jsxs)("span",{className:"text-sm text-gray-400 print:text-gray-600",children:["(",i.length," itens)"]})]})}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"border-b border-white/10 print:border-gray-300",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left py-2 text-gray-400 print:text-gray-600",children:"C\xf3digo"}),(0,r.jsx)("th",{className:"text-left py-2 text-gray-400 print:text-gray-600",children:"Produto"}),(0,r.jsx)("th",{className:"text-right py-2 text-gray-400 print:text-gray-600",children:"50-199"}),(0,r.jsx)("th",{className:"text-right py-2 text-gray-400 print:text-gray-600",children:"200-699"}),(0,r.jsx)("th",{className:"text-right py-2 text-gray-400 print:text-gray-600",children:"Atacado"}),(0,r.jsx)("th",{className:"text-right py-2 text-gray-400 print:text-gray-600",children:"\xc0 Vista"}),(0,r.jsx)("th",{className:"text-right py-2 text-gray-400 print:text-gray-600",children:"Redes"})]})}),(0,r.jsx)("tbody",{children:i.map(e=>{var t,a,i,s,o;return(0,r.jsxs)("tr",{className:"border-b border-white/5 print:border-gray-200 hover:bg-white/5 print:hover:bg-transparent transition-colors",children:[(0,r.jsx)("td",{className:"py-2 font-mono text-gray-400 print:text-gray-600 text-xs",children:e.codigo}),(0,r.jsx)("td",{className:"py-2 text-white print:text-black font-medium",children:e.nome}),(0,r.jsxs)("td",{className:"py-2 text-right text-green-400 print:text-green-600",children:["R$ ",(null===(t=e.preco50a199)||void 0===t?void 0:t.toFixed(2))||"0.00"]}),(0,r.jsxs)("td",{className:"py-2 text-right text-green-400 print:text-green-600",children:["R$ ",(null===(a=e.preco200a699)||void 0===a?void 0:a.toFixed(2))||"0.00"]}),(0,r.jsxs)("td",{className:"py-2 text-right text-green-400 print:text-green-600",children:["R$ ",(null===(i=e.precoAtacado)||void 0===i?void 0:i.toFixed(2))||"0.00"]}),(0,r.jsxs)("td",{className:"py-2 text-right text-green-400 print:text-green-600",children:["R$ ",(null===(s=e.precoAtacadoAVista)||void 0===s?void 0:s.toFixed(2))||"0.00"]}),(0,r.jsxs)("td",{className:"py-2 text-right text-green-400 print:text-green-600",children:["R$ ",(null===(o=e.precoRedes)||void 0===o?void 0:o.toFixed(2))||"0.00"]})]},e.id)})})]})})]},t)})})()})]})]})}},5590:function(e,t,a){"use strict";a.d(t,{F:function(){return m},e:function(){return p}});var r=a(3827),i=a(64090),s=a(46578),o=a(98998),l=a(28814),n=a(52235),c=a(28745),d=a(38371);function x(e){let{message:t,type:a,isVisible:x=!0,onClose:h}=e;return(0,i.useEffect)(()=>{if(x){let e=setTimeout(()=>{h()},3e3);return()=>clearTimeout(e)}},[x,h]),(0,r.jsx)(c.M,{children:x&&(0,r.jsxs)(d.E.div,{initial:{opacity:0,y:50,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.9},className:"fixed bottom-6 right-6 z-50 flex items-center gap-3 rounded-xl border border-white/10 bg-black/80 px-4 py-3 text-sm text-white shadow-2xl backdrop-blur-md",children:[(0,r.jsxs)("div",{className:"rounded-full p-1 ".concat("success"===a?"bg-green-500/20 text-green-500":"error"===a?"bg-red-500/20 text-red-500":"bg-blue-500/20 text-blue-500"),children:["success"===a&&(0,r.jsx)(s.Z,{className:"h-4 w-4"}),"error"===a&&(0,r.jsx)(o.Z,{className:"h-4 w-4"}),"info"===a&&(0,r.jsx)(l.Z,{className:"h-4 w-4"})]}),(0,r.jsx)("span",{className:"font-medium pr-2",children:t}),(0,r.jsx)("button",{onClick:h,className:"ml-2 rounded-lg p-1 text-gray-400 hover:bg-white/10 hover:text-white transition-colors",children:(0,r.jsx)(n.Z,{className:"h-3 w-3"})})]})})}let h=(0,i.createContext)(void 0);function m(e){let{children:t}=e,[a,s]=(0,i.useState)([]),[o,l]=(0,i.useState)([]),[n,c]=(0,i.useState)([]),[d,m]=(0,i.useState)([]),[p,g]=(0,i.useState)(!0),[u,b]=(0,i.useState)(null),[y,f]=(0,i.useState)(null),j=(0,i.useCallback)((e,t)=>{f({message:e,type:t})},[]),v=(0,i.useCallback)(async()=>{g(!0);try{let[e,t,a,r]=await Promise.all([fetch("/api/clients"),fetch("/api/products"),fetch("/api/orders"),fetch("/api/fabricas")]);e.ok&&s(await e.json()),t.ok&&l(await t.json()),a.ok&&c(await a.json()),r.ok&&m(await r.json())}catch(e){console.error("Error fetching data:",e),j("Erro ao carregar dados","error")}finally{g(!1)}},[j]);(0,i.useEffect)(()=>{v();let e=localStorage.getItem("frplus_user");e&&b(e)},[v]);let N=async e=>{try{let t=await fetch("/api/clients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let e=await t.json();s(t=>[...t,e]),j("Cliente cadastrado com sucesso!","success")}else j("Erro ao cadastrar cliente","error")}catch(e){console.error("Error adding client:",e),j("Erro ao cadastrar cliente","error")}},w=async(e,t)=>{try{let a=await fetch("/api/clients/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(a.ok){let t=await a.json();s(a=>a.map(a=>a.id===e?t:a)),j("Cliente atualizado com sucesso!","success")}}catch(e){console.error("Error updating client:",e),j("Erro ao atualizar cliente","error")}},S=async e=>{try{(await fetch("/api/clients/".concat(e),{method:"DELETE"})).ok&&(s(t=>t.filter(t=>t.id!==e)),j("Cliente exclu\xeddo com sucesso!","success"))}catch(e){console.error("Error removing client:",e),j("Erro ao excluir cliente","error")}},C=async e=>{try{(await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok?(await v(),j("Produto cadastrado com sucesso!","success")):j("Erro ao cadastrar produto","error")}catch(e){console.error("Error adding product:",e),j("Erro ao cadastrar produto","error")}},T=async(e,t)=>{try{(await fetch("/api/products/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(await v(),j("Produto atualizado com sucesso!","success"))}catch(e){console.error("Error updating product:",e),j("Erro ao atualizar produto","error")}},R=async e=>{try{(await fetch("/api/products/".concat(e),{method:"DELETE"})).ok&&(l(t=>t.filter(t=>t.id!==e)),j("Produto exclu\xeddo com sucesso!","success"))}catch(e){console.error("Error removing product:",e),j("Erro ao excluir produto","error")}},F=async e=>{try{(await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok?(await v(),j("Pedido cadastrado com sucesso!","success")):j("Erro ao cadastrar pedido","error")}catch(e){console.error("Error adding order:",e),j("Erro ao cadastrar pedido","error")}},P=async(e,t)=>{try{(await fetch("/api/orders/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(await v(),j("Pedido atualizado com sucesso!","success"))}catch(e){console.error("Error updating order:",e),j("Erro ao atualizar pedido","error")}},k=async e=>{try{(await fetch("/api/orders/".concat(e),{method:"DELETE"})).ok&&(c(t=>t.filter(t=>t.id!==e)),j("Pedido exclu\xeddo com sucesso!","success"))}catch(e){console.error("Error removing order:",e),j("Erro ao excluir pedido","error")}},E=async e=>{try{let t=await fetch("/api/fabricas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let e=await t.json();m(t=>[...t,e]),j("F\xe1brica cadastrada com sucesso!","success")}}catch(e){console.error("Error adding fabrica:",e),j("Erro ao cadastrar f\xe1brica","error")}},D=async(e,t)=>{try{(await fetch("/api/fabricas/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(await v(),j("F\xe1brica atualizada com sucesso!","success"))}catch(e){console.error("Error updating fabrica:",e),j("Erro ao atualizar f\xe1brica","error")}},O=async e=>{try{(await fetch("/api/fabricas/".concat(e),{method:"DELETE"})).ok&&(m(t=>t.filter(t=>t.id!==e)),j("F\xe1brica exclu\xedda com sucesso!","success"))}catch(e){console.error("Error removing fabrica:",e),j("Erro ao excluir f\xe1brica","error")}};return(0,r.jsxs)(h.Provider,{value:{clients:a,products:o,orders:n,fabricas:d,loading:p,addClient:N,updateClient:w,removeClient:S,addProduct:C,updateProduct:T,removeProduct:R,addOrder:F,updateOrder:P,removeOrder:k,addFabrica:E,updateFabrica:D,removeFabrica:O,getDashboardStats:()=>({totalSales:n.reduce((e,t)=>e+t.valorTotal,0),totalOrders:n.length,newClients:a.length,totalProducts:o.length}),showToast:j,user:u,login:e=>{b(e),localStorage.setItem("frplus_user",e)},logout:()=>{b(null),localStorage.removeItem("frplus_user")},refreshData:v},children:[t,y&&(0,r.jsx)(x,{message:y.message,type:y.type,onClose:()=>f(null)})]})}function p(){let e=(0,i.useContext)(h);if(void 0===e)throw Error("useData must be used within a DataProvider");return e}}},function(e){e.O(0,[462,558,971,69,744],function(){return e(e.s=66322)}),_N_E=e.O()}]);