(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[129],{23895:function(e,t,a){Promise.resolve().then(a.bind(a,80595))},80595:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var r=a(3827),s=a(8792),o=a(53879),c=a(28670),i=a(95132),l=a(4697),n=a(80037),d=a(70094),u=a(82800),x=a(11213),h=a(50489),m=a(18727),p=a(48219),f=a(70699),g=a(5590),b=a(64090),j=a(47907),w=a(38371),y=a(28745);function v(e){let{params:t}=e,{orders:a,clients:v,products:N,updateOrder:E,showToast:C,fabricas:k}=(0,g.e)(),S=(0,j.useRouter)(),[P,T]=(0,b.useState)(""),[O,Z]=(0,b.useState)(""),[z,L]=(0,b.useState)(""),[q,I]=(0,b.useState)([]),[F,_]=(0,b.useState)("");(0,b.useEffect)(()=>{let e=a.find(e=>e.id===t.id);e&&(T(e.clienteId),I(e.itens),_(e.observacoes||""))},[a,t.id]);let J=v.find(e=>e.id===P),U=(0,b.useMemo)(()=>O?v.filter(e=>(e.nomeFantasia||e.razaoSocial||"").toLowerCase().includes(O.toLowerCase())||e.cnpj.includes(O)).slice(0,5):v.slice(0,5),[v,O]),D=(0,b.useMemo)(()=>z?N.filter(e=>e.nome.toLowerCase().includes(z.toLowerCase())||e.codigo.toLowerCase().includes(z.toLowerCase())):N,[N,z]),M=e=>{var t;return e&&(null===(t=k.find(t=>t.id===e))||void 0===t?void 0:t.nome)||"-"},R=(0,b.useMemo)(()=>D.reduce((e,t)=>{let a=t.fabricaId||"sem-fabrica";return e[a]||(e[a]=[]),e[a].push(t),e},{}),[D]),A=e=>{switch((null==J?void 0:J.tabelaPreco)||"50a199"){case"200a699":return e.preco200a699;case"atacado":return e.precoAtacado;case"atacadoAVista":return e.precoAtacadoAVista;case"redes":return e.precoRedes;default:return e.preco50a199}},B=e=>{let t=q.findIndex(t=>t.produtoId===e.id),a=A(e);t>=0?I(e=>e.map((e,a)=>a===t?{...e,quantidade:e.quantidade+1,total:(e.quantidade+1)*e.precoUnitario}:e)):I(t=>[...t,{produtoId:e.id,nomeProduto:e.nome,quantidade:1,precoUnitario:a,total:a}]),C("".concat(e.nome," adicionado!"),"success")},$=(e,t)=>{I(a=>a.map((a,r)=>{if(r!==e)return a;let s=Math.max(1,a.quantidade+t);return{...a,quantidade:s,total:s*a.precoUnitario}}))},V=e=>{I(t=>t.filter((t,a)=>a!==e))},G=q.reduce((e,t)=>e+t.total,0),H=q.reduce((e,t)=>e+t.quantidade,0);return(0,r.jsxs)("div",{className:"h-[calc(100vh-100px)] flex gap-4",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(s.default,{href:"/dashboard/pedidos",className:"p-2 rounded-lg hover:bg-white/10 text-gray-400",children:(0,r.jsx)(o.Z,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-xl font-bold text-white",children:["Editar Pedido #",t.id.slice(-6)]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Modifique os itens abaixo"})]})]})}),(0,r.jsxs)("div",{className:"relative mb-4",children:[(0,r.jsx)(c.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-500"}),(0,r.jsx)("input",{type:"text",value:z,onChange:e=>L(e.target.value),placeholder:"Buscar produto por nome ou c\xf3digo...",className:"input-compact pl-10 w-full"})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto pr-2 space-y-8",children:Object.keys(R).length>0?Object.entries(R).sort((e,t)=>{let a="sem-fabrica"===e[0]?"Outros":M(e[0]),r="sem-fabrica"===t[0]?"Outros":M(t[0]);return"sem-fabrica"===e[0]?1:"sem-fabrica"===t[0]?-1:a.localeCompare(r)}).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 px-1",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4 text-blue-400"}),(0,r.jsx)("h3",{className:"text-sm font-bold text-white uppercase tracking-wider",children:"sem-fabrica"===t?"Outros":M(t)}),(0,r.jsx)("div",{className:"h-px flex-1 bg-white/10 ml-4"})]}),(0,r.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-3",children:a.map((e,t)=>{var a;let s=A(e),o=q.some(t=>t.produtoId===e.id);return(0,r.jsxs)(w.E.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.03*t},onClick:()=>B(e),className:"relative group p-3 rounded-xl border text-left transition-all hover:scale-[1.02] ".concat(o?"border-green-500/50 bg-green-500/10":"border-white/10 bg-white/5 hover:border-blue-500/50 hover:bg-blue-500/5"),children:[o&&(0,r.jsx)("div",{className:"absolute -top-2 -right-2 w-5 h-5 rounded-full bg-green-500 flex items-center justify-center z-10 shadow-lg shadow-green-500/20",children:(0,r.jsx)("span",{className:"text-[10px] font-bold text-white",children:null===(a=q.find(t=>t.produtoId===e.id))||void 0===a?void 0:a.quantidade})}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 overflow-hidden ".concat(o?"bg-green-500/20":"bg-white/5"),children:e.imagem?(0,r.jsx)("img",{src:e.imagem,alt:e.nome,className:"w-full h-full object-cover"}):(0,r.jsx)(l.Z,{className:"h-5 w-5 ".concat(o?"text-green-400":"text-gray-400")})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsx)("p",{className:"text-[10px] text-gray-500 font-mono",children:e.codigo}),o&&(0,r.jsx)(n.Z,{className:"h-3 w-3 text-green-400"})]}),(0,r.jsx)("p",{className:"text-xs font-medium text-white truncate my-0.5",title:e.nome,children:e.nome}),(0,r.jsxs)("p",{className:"text-sm font-bold text-green-400",children:["R$ ",s.toFixed(2)]})]})]}),(0,r.jsx)("div",{className:"absolute inset-0 rounded-xl bg-blue-600/0 group-hover:bg-blue-600/5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all pointer-events-none",children:(0,r.jsx)(d.Z,{className:"h-6 w-6 text-blue-400 drop-shadow-lg"})})]},e.id)})})]},t)}):(0,r.jsxs)("div",{className:"text-center py-12 text-gray-500 bg-white/5 rounded-xl border border-dashed border-white/10",children:[(0,r.jsx)(l.Z,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,r.jsx)("p",{children:"Nenhum produto encontrado"})]})})]}),(0,r.jsxs)("div",{className:"w-96 flex flex-col bg-white/5 rounded-2xl border border-white/10 overflow-hidden",children:[(0,r.jsx)("div",{className:"p-4 border-b border-white/10 bg-gradient-to-r from-orange-600/20 to-amber-600/20",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 rounded-lg bg-white/10",children:(0,r.jsx)(u.Z,{className:"h-5 w-5 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"font-bold text-white",children:"Editando Pedido"}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:[H," itens"]})]})]})}),(0,r.jsxs)("div",{className:"p-4 border-b border-white/10",children:[(0,r.jsx)("label",{className:"text-xs text-gray-400 mb-1 block",children:"Cliente"}),J?(0,r.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-green-500/10 border border-green-500/30",children:[(0,r.jsx)("div",{className:"p-1.5 rounded-lg bg-green-500/20",children:(0,r.jsx)(x.Z,{className:"h-4 w-4 text-green-400"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-white truncate",children:J.nome}),(0,r.jsxs)("p",{className:"text-[10px] text-gray-400",children:["Tabela: ",J.tabelaPreco||"50a199"]})]}),(0,r.jsx)("button",{onClick:()=>T(""),className:"text-gray-400 hover:text-white",children:(0,r.jsx)(h.Z,{className:"h-4 w-4"})})]}):(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(c.Z,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3 w-3 text-gray-500"}),(0,r.jsx)("input",{type:"text",value:O,onChange:e=>Z(e.target.value),placeholder:"Buscar cliente...",className:"input-compact pl-7 w-full text-sm"})]}),(0,r.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:U.map(e=>(0,r.jsx)("button",{onClick:()=>{T(e.id),Z("")},className:"w-full text-left p-2 rounded-lg hover:bg-white/10 text-sm text-gray-300 hover:text-white transition-colors",children:e.nomeFantasia||e.razaoSocial},e.id))})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[(0,r.jsx)(y.M,{children:q.map((e,t)=>(0,r.jsxs)(w.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/5",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-white truncate",children:e.nomeProduto}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:["R$ ",e.precoUnitario.toFixed(2)," un."]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 bg-black/30 rounded-lg p-1",children:[(0,r.jsx)("button",{onClick:()=>$(t,-1),className:"w-6 h-6 rounded flex items-center justify-center text-gray-400 hover:bg-white/10 hover:text-white",children:"-"}),(0,r.jsx)("span",{className:"w-8 text-center text-sm font-bold text-white",children:e.quantidade}),(0,r.jsx)("button",{onClick:()=>$(t,1),className:"w-6 h-6 rounded flex items-center justify-center text-gray-400 hover:bg-white/10 hover:text-white",children:"+"})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"text-sm font-bold text-green-400",children:["R$ ",e.total.toFixed(2)]}),(0,r.jsx)("button",{onClick:()=>V(t),className:"text-[10px] text-red-400 hover:text-red-300",children:"remover"})]})]},e.produtoId))}),0===q.length&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)(m.Z,{className:"h-6 w-6 mx-auto mb-2 opacity-50"}),(0,r.jsx)("p",{className:"text-sm",children:"Clique nos produtos para adicionar"})]})]}),(0,r.jsx)("div",{className:"px-4 pb-2",children:(0,r.jsx)("input",{type:"text",value:F,onChange:e=>_(e.target.value),placeholder:"Observa\xe7\xf5es do pedido...",className:"input-compact w-full text-sm"})}),(0,r.jsxs)("div",{className:"p-4 border-t border-white/10 bg-gradient-to-r from-orange-600/10 to-amber-600/10",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Total"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(p.Z,{className:"h-5 w-5 text-green-400"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-white",children:G.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]})]}),(0,r.jsxs)("button",{onClick:()=>{if(!P){C("Selecione um cliente","error");return}if(0===q.length){C("Adicione pelo menos um produto","error");return}let e={clienteId:P,nomeCliente:(null==J?void 0:J.nome)||"",itens:q,valorTotal:G,observacoes:F};E(t.id,e),S.push("/dashboard/pedidos")},disabled:!P||0===q.length,className:"w-full py-3 rounded-xl bg-gradient-to-r from-orange-600 to-amber-500 text-white font-bold flex items-center justify-center gap-2 hover:from-orange-500 hover:to-amber-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-orange-600/30",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4"}),"Salvar Altera\xe7\xf5es"]})]})]})]})}},5590:function(e,t,a){"use strict";a.d(t,{F:function(){return h},e:function(){return m}});var r=a(3827),s=a(64090),o=a(46578),c=a(98998),i=a(28814),l=a(52235),n=a(28745),d=a(38371);function u(e){let{message:t,type:a,isVisible:u=!0,onClose:x}=e;return(0,s.useEffect)(()=>{if(u){let e=setTimeout(()=>{x()},3e3);return()=>clearTimeout(e)}},[u,x]),(0,r.jsx)(n.M,{children:u&&(0,r.jsxs)(d.E.div,{initial:{opacity:0,y:50,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.9},className:"fixed bottom-6 right-6 z-50 flex items-center gap-3 rounded-xl border border-white/10 bg-black/80 px-4 py-3 text-sm text-white shadow-2xl backdrop-blur-md",children:[(0,r.jsxs)("div",{className:"rounded-full p-1 ".concat("success"===a?"bg-green-500/20 text-green-500":"error"===a?"bg-red-500/20 text-red-500":"bg-blue-500/20 text-blue-500"),children:["success"===a&&(0,r.jsx)(o.Z,{className:"h-4 w-4"}),"error"===a&&(0,r.jsx)(c.Z,{className:"h-4 w-4"}),"info"===a&&(0,r.jsx)(i.Z,{className:"h-4 w-4"})]}),(0,r.jsx)("span",{className:"font-medium pr-2",children:t}),(0,r.jsx)("button",{onClick:x,className:"ml-2 rounded-lg p-1 text-gray-400 hover:bg-white/10 hover:text-white transition-colors",children:(0,r.jsx)(l.Z,{className:"h-3 w-3"})})]})})}let x=(0,s.createContext)(void 0);function h(e){let{children:t}=e,[a,o]=(0,s.useState)([]),[c,i]=(0,s.useState)([]),[l,n]=(0,s.useState)([]),[d,h]=(0,s.useState)([]),[m,p]=(0,s.useState)(!0),[f,g]=(0,s.useState)(null),[b,j]=(0,s.useState)(null),w=(0,s.useCallback)((e,t)=>{j({message:e,type:t})},[]),y=(0,s.useCallback)(async()=>{p(!0);try{let[e,t,a,r]=await Promise.all([fetch("/api/clients"),fetch("/api/products"),fetch("/api/orders"),fetch("/api/fabricas")]);e.ok&&o(await e.json()),t.ok&&i(await t.json()),a.ok&&n(await a.json()),r.ok&&h(await r.json())}catch(e){console.error("Error fetching data:",e),w("Erro ao carregar dados","error")}finally{p(!1)}},[w]);(0,s.useEffect)(()=>{y();let e=localStorage.getItem("frplus_user");e&&g(e)},[y]);let v=async e=>{try{let t=await fetch("/api/clients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let e=await t.json();o(t=>[...t,e]),w("Cliente cadastrado com sucesso!","success")}else w("Erro ao cadastrar cliente","error")}catch(e){console.error("Error adding client:",e),w("Erro ao cadastrar cliente","error")}},N=async(e,t)=>{try{let a=await fetch("/api/clients/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(a.ok){let t=await a.json();o(a=>a.map(a=>a.id===e?t:a)),w("Cliente atualizado com sucesso!","success")}}catch(e){console.error("Error updating client:",e),w("Erro ao atualizar cliente","error")}},E=async e=>{try{(await fetch("/api/clients/".concat(e),{method:"DELETE"})).ok&&(o(t=>t.filter(t=>t.id!==e)),w("Cliente exclu\xeddo com sucesso!","success"))}catch(e){console.error("Error removing client:",e),w("Erro ao excluir cliente","error")}},C=async e=>{try{(await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok?(await y(),w("Produto cadastrado com sucesso!","success")):w("Erro ao cadastrar produto","error")}catch(e){console.error("Error adding product:",e),w("Erro ao cadastrar produto","error")}},k=async(e,t)=>{try{(await fetch("/api/products/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(await y(),w("Produto atualizado com sucesso!","success"))}catch(e){console.error("Error updating product:",e),w("Erro ao atualizar produto","error")}},S=async e=>{try{(await fetch("/api/products/".concat(e),{method:"DELETE"})).ok&&(i(t=>t.filter(t=>t.id!==e)),w("Produto exclu\xeddo com sucesso!","success"))}catch(e){console.error("Error removing product:",e),w("Erro ao excluir produto","error")}},P=async e=>{try{(await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok?(await y(),w("Pedido cadastrado com sucesso!","success")):w("Erro ao cadastrar pedido","error")}catch(e){console.error("Error adding order:",e),w("Erro ao cadastrar pedido","error")}},T=async(e,t)=>{try{(await fetch("/api/orders/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(await y(),w("Pedido atualizado com sucesso!","success"))}catch(e){console.error("Error updating order:",e),w("Erro ao atualizar pedido","error")}},O=async e=>{try{(await fetch("/api/orders/".concat(e),{method:"DELETE"})).ok&&(n(t=>t.filter(t=>t.id!==e)),w("Pedido exclu\xeddo com sucesso!","success"))}catch(e){console.error("Error removing order:",e),w("Erro ao excluir pedido","error")}},Z=async e=>{try{let t=await fetch("/api/fabricas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let e=await t.json();h(t=>[...t,e]),w("F\xe1brica cadastrada com sucesso!","success")}}catch(e){console.error("Error adding fabrica:",e),w("Erro ao cadastrar f\xe1brica","error")}},z=async(e,t)=>{try{(await fetch("/api/fabricas/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(await y(),w("F\xe1brica atualizada com sucesso!","success"))}catch(e){console.error("Error updating fabrica:",e),w("Erro ao atualizar f\xe1brica","error")}},L=async e=>{try{(await fetch("/api/fabricas/".concat(e),{method:"DELETE"})).ok&&(h(t=>t.filter(t=>t.id!==e)),w("F\xe1brica exclu\xedda com sucesso!","success"))}catch(e){console.error("Error removing fabrica:",e),w("Erro ao excluir f\xe1brica","error")}};return(0,r.jsxs)(x.Provider,{value:{clients:a,products:c,orders:l,fabricas:d,loading:m,addClient:v,updateClient:N,removeClient:E,addProduct:C,updateProduct:k,removeProduct:S,addOrder:P,updateOrder:T,removeOrder:O,addFabrica:Z,updateFabrica:z,removeFabrica:L,getDashboardStats:()=>({totalSales:l.reduce((e,t)=>e+t.valorTotal,0),totalOrders:l.length,newClients:a.length,totalProducts:c.length}),showToast:w,user:f,login:e=>{g(e),localStorage.setItem("frplus_user",e)},logout:()=>{g(null),localStorage.removeItem("frplus_user")},refreshData:y},children:[t,b&&(0,r.jsx)(u,{message:b.message,type:b.type,onClose:()=>j(null)})]})}function m(){let e=(0,s.useContext)(x);if(void 0===e)throw Error("useData must be used within a DataProvider");return e}}},function(e){e.O(0,[462,792,264,971,69,744],function(){return e(e.s=23895)}),_N_E=e.O()}]);