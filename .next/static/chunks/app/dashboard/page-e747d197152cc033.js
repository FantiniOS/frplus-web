(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{46201:function(e,t,s){Promise.resolve().then(s.bind(s,63470))},63470:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var a=s(3827),r=s(48219),i=s(8967),l=s(82800),o=s(29733),n=s(34059),c=s(4697),d=s(5590),x=s(83779),m=s(8792),h=s(64090),u=s(95200),p=s(37805),g=s(61524),f=s(67366);function b(){let[e,t]=(0,h.useState)([]),[s,r]=(0,h.useState)([]),[i,l]=(0,h.useState)([]),[n,c]=(0,h.useState)(!0),[d,x]=(0,h.useState)({inactive:{total:0,vermelho:0,laranja:0,amarelo:0},opportunities:{total:0},insights:{total:0}});(0,h.useEffect)(()=>{(async()=>{try{var e,s,a;let[i,o,n]=await Promise.all([fetch("/api/ai/inactive-clients?days=30"),fetch("/api/ai/opportunities"),fetch("/api/ai/sales-insights")]);if(i.ok){let s=await i.json();t((null===(e=s.clients)||void 0===e?void 0:e.slice(0,5))||[]),x(e=>({...e,inactive:s.summary}))}if(o.ok){let e=await o.json();r((null===(s=e.opportunities)||void 0===s?void 0:s.slice(0,5))||[]),x(t=>{var s;return{...t,opportunities:{total:(null===(s=e.summary)||void 0===s?void 0:s.total)||0}}})}if(n.ok){let e=await n.json();l((null===(a=e.insights)||void 0===a?void 0:a.slice(0,5))||[]),x(t=>{var s;return{...t,insights:{total:(null===(s=e.summary)||void 0===s?void 0:s.total)||0}}})}}catch(e){console.error("Error fetching AI insights:",e)}finally{c(!1)}})()},[]);let b={vermelho:"bg-red-500/20 text-red-400 border-red-500/30",laranja:"bg-orange-500/20 text-orange-400 border-orange-500/30",amarelo:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",verde:"bg-green-500/20 text-green-400 border-green-500/30"},j={alta:"bg-red-500/10 text-red-400",media:"bg-yellow-500/10 text-yellow-400",baixa:"bg-green-500/10 text-green-400"};return n?(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:[1,2,3].map(e=>(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-6 animate-pulse",children:[(0,a.jsx)("div",{className:"h-4 bg-white/10 rounded w-1/2 mb-4"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"h-3 bg-white/10 rounded"}),(0,a.jsx)("div",{className:"h-3 bg-white/10 rounded w-3/4"})]})]},e))}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg bg-purple-500/20",children:(0,a.jsx)(u.Z,{className:"h-5 w-5 text-purple-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Intelig\xeancia Comercial"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Insights automatizados para alavancar suas vendas"})]})]}),(0,a.jsxs)(m.default,{href:"/dashboard/ai-insights",className:"text-xs text-purple-400 hover:text-purple-300 flex items-center gap-1",children:["Ver An\xe1lise Completa ",(0,a.jsx)(p.Z,{className:"h-3 w-3"})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 text-red-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-white",children:"Clientes Inativos"})]}),(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-red-500/20 text-red-400",children:d.inactive.total})]}),0===e.length?(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center py-4",children:"Nenhum cliente inativo"}):(0,a.jsx)("div",{className:"space-y-2",children:e.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-white truncate",children:e.nomeFantasia}),(0,a.jsx)("p",{className:"text-[10px] text-gray-500",children:e.diasInativo?"".concat(e.diasInativo," dias sem comprar"):"Nunca comprou"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(b[e.alertLevel].split(" ")[0])}),(0,a.jsx)("a",{href:"https://wa.me/55".concat(null===(t=e.telefone)||void 0===t?void 0:t.replace(/\D/g,"")),target:"_blank",className:"p-1 hover:bg-green-500/20 rounded",children:(0,a.jsx)(f.Z,{className:"h-3 w-3 text-green-400"})})]})]},e.id)})})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 text-yellow-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-white",children:"Oportunidades"})]}),(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-yellow-500/20 text-yellow-400",children:d.opportunities.total})]}),0===s.length?(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center py-4",children:"Nenhuma oportunidade identificada"}):(0,a.jsx)("div",{className:"space-y-2",children:s.map((e,t)=>(0,a.jsxs)("div",{className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-white truncate",children:e.clienteNome}),(0,a.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded ".concat(j[e.priority]),children:"upgrade"===e.type?"⬆️":"crossSell"===e.type?"\uD83D\uDED2":"\uD83D\uDCC5"})]}),(0,a.jsx)("p",{className:"text-[10px] text-gray-400 line-clamp-2",children:e.description})]},t))})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 text-blue-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-white",children:"Alavancagem"})]}),(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-500/20 text-blue-400",children:d.insights.total})]}),0===i.length?(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center py-4",children:"Nenhum insight dispon\xedvel"}):(0,a.jsx)("div",{className:"space-y-2",children:i.map((e,t)=>(0,a.jsxs)("div",{className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-white truncate",children:e.clienteNome}),(0,a.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded ".concat(j[e.priority]),children:e.priority})]}),(0,a.jsx)("p",{className:"text-[10px] text-gray-400",children:e.description}),(0,a.jsx)("p",{className:"text-[10px] text-blue-400 mt-1",children:e.metric})]},t))})]})]})]})}function j(){var e;let{usuario:t}=(0,x.a)(),{orders:s,products:u,clients:p}=(0,d.e)(),g=new Date,[f,j]=(0,h.useState)(()=>{let e=g.getFullYear(),t=String(g.getMonth()+1).padStart(2,"0");return"".concat(e,"-").concat(t)}),[w,y]=f.split("-"),v=f?parseInt(w):null,N=f?parseInt(y)-1:null,E=s.filter(e=>{if(!f)return!0;let t=new Date(e.data);return t.getUTCMonth()===N&&t.getUTCFullYear()===v}),S={totalSales:E.reduce((e,t)=>e+t.valorTotal,0),totalOrders:E.length,newClients:p.length,totalProducts:u.length},D=f?new Date(v,N+1,0).getDate():30,k=v||new Date().getFullYear(),C=null!==N?N:new Date().getMonth(),T=Array.from({length:new Date(k,C+1,0).getDate()},(e,t)=>t+1).map(e=>{let t=s.filter(t=>{let s=new Date(t.data);return s.getUTCFullYear()===k&&s.getUTCMonth()===C&&s.getUTCDate()===e}).reduce((e,t)=>e+t.valorTotal,0);return{date:new Date(k,C,e).toISOString(),dayLabel:String(e),value:t}}),P=Math.max(...T.map(e=>e.value),100),O=new Map;E.forEach(e=>{e.itens.forEach(e=>{let t=O.get(e.produtoId)||0;O.set(e.produtoId,t+e.quantidade)})});let I=Array.from(O.entries()).map(e=>{let[t,s]=e,a=u.find(e=>e.id===t);return{name:(null==a?void 0:a.nome)||"Produto Desconhecido",qtd:s,total:((null==a?void 0:a.preco50a199)||0)*s}}).sort((e,t)=>t.qtd-e.qtd).slice(0,4),Z=[...E].sort((e,t)=>new Date(t.data).getTime()-new Date(e.data).getTime()).slice(0,5),F=f?new Date(v,N,1).toLocaleDateString("pt-BR",{month:"long"}):"Per\xedodo Completo";return(0,a.jsxs)("div",{className:"space-y-8 animate-in fade-in duration-500",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold tracking-tight text-white",children:[(()=>{let e=new Date().getHours();return e<12?"Bom dia":e<18?"Boa tarde":"Boa noite"})(),", ",(null==t?void 0:null===(e=t.nome)||void 0===e?void 0:e.split(" ")[0])||"Bem-vindo"]}),(0,a.jsxs)("p",{className:"text-emerald-400 font-medium capitalize flex items-center gap-2",children:["\uD83D\uDCC5 Vis\xe3o: ",f?"".concat(F," / ").concat(v):"Todo o Hist\xf3rico"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative group flex gap-2",children:[(0,a.jsx)("input",{type:"month",value:f,onChange:e=>j(e.target.value),className:"bg-gray-800 border border-gray-700 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 [color-scheme:dark]"}),f&&(0,a.jsx)("button",{onClick:()=>j(""),className:"text-xs text-red-400 hover:text-red-300 underline",children:"Limpar"})]}),(0,a.jsx)(m.default,{href:"/dashboard/pedidos/novo",children:(0,a.jsx)("button",{className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-500 transition-colors shadow-lg shadow-blue-900/20 whitespace-nowrap",children:"+ Novo Pedido"})})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between space-y-0 pb-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-400",children:["Vendas (",F,")"]}),(0,a.jsx)(r.Z,{className:"h-4 w-4 text-green-500"})]}),(0,a.jsxs)("div",{className:"text-2xl font-bold text-white",children:["R$ ",S.totalSales.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),(0,a.jsxs)("p",{className:"text-xs text-green-500 flex items-center mt-1",children:[(0,a.jsx)(i.Z,{className:"h-3 w-3 mr-1"})," Sele\xe7\xe3o atual"]})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between space-y-0 pb-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-400",children:["Pedidos (",F,")"]}),(0,a.jsx)(l.Z,{className:"h-4 w-4 text-blue-500"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-white",children:S.totalOrders}),(0,a.jsxs)("p",{className:"text-xs text-blue-500 flex items-center mt-1",children:[(0,a.jsx)(o.Z,{className:"h-3 w-3 mr-1"})," Sele\xe7\xe3o atual"]})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-400",children:"Base de Clientes"}),(0,a.jsx)(n.Z,{className:"h-4 w-4 text-orange-500"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-white",children:S.newClients}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Total cadastrado"})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-400",children:"Produtos"}),(0,a.jsx)(c.Z,{className:"h-4 w-4 text-pink-500"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-white",children:u.length}),(0,a.jsx)("p",{className:"text-xs text-pink-500 flex items-center mt-1",children:"Itens cadastrados"})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-7",children:[(0,a.jsxs)("div",{className:"col-span-4 rounded-xl border border-white/10 bg-white/5 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-white",children:["Vendas Di\xe1rias (",F,")"]}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Dados do per\xedodo selecionado"})]}),(0,a.jsx)("div",{className:"flex h-64 items-end space-x-1 pt-4 border-b border-white/5 pb-2 overflow-x-auto",children:T.map((e,t)=>{let s=Math.max(e.value/P*100,4);return(0,a.jsxs)("div",{className:"group relative flex-1 min-w-[10px] flex flex-col justify-end items-center gap-2 h-full",children:[(0,a.jsx)("div",{className:"w-full rounded-t-sm bg-blue-600 hover:bg-blue-400 transition-all duration-500 ease-out",style:{height:"".concat(s,"%")}}),(0,a.jsxs)("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 rounded bg-white px-2 py-1 text-xs font-bold text-black opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10 pointer-events-none",children:["Dia ",e.dayLabel,": R$ ",e.value.toFixed(0)]})]},t)})}),(0,a.jsxs)("div",{className:"mt-2 flex justify-between text-[10px] text-gray-500 uppercase px-1",children:[(0,a.jsx)("span",{children:"Dia 1"}),(0,a.jsx)("span",{children:"Dia 15"}),(0,a.jsxs)("span",{children:["Dia ",D]})]})]}),(0,a.jsxs)("div",{className:"col-span-3 space-y-4",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4 text-white",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 text-purple-400"}),(0,a.jsxs)("h3",{className:"text-lg font-semibold",children:["Mais Vendidos (",F,")"]})]}),(0,a.jsx)("div",{className:"space-y-4",children:0===I.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Sem dados de vendas neste per\xedodo."}):I.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-purple-500/10 text-xs font-bold text-purple-400",children:t+1}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-white",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.qtd," unidades"]})]})]}),(0,a.jsxs)("span",{className:"text-sm font-medium text-white",children:["R$ ",e.total.toFixed(0)]})]},t))})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-6",children:[(0,a.jsxs)("h3",{className:"mb-4 text-lg font-semibold text-white",children:["Pedidos Recentes (",F,")"]}),(0,a.jsxs)("div",{className:"space-y-3",children:[0===Z.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Nenhuma venda recente."}):Z.slice(0,3).map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between border-b border-white/5 pb-2 last:border-0 last:pb-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-white",children:e.nomeCliente}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.data).toLocaleDateString()})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("p",{className:"text-sm font-bold text-white",children:["R$ ",e.valorTotal.toFixed(2)]})})]},t)),Z.length>0&&(0,a.jsx)(m.default,{href:"/dashboard/pedidos",className:"block text-center text-xs text-blue-400 hover:text-blue-300 mt-2",children:"Ver todos"})]})]})]})]}),(0,a.jsx)(b,{}),(0,a.jsxs)("div",{className:"mt-8 p-4 bg-black/50 text-xs font-mono text-green-400 rounded border border-green-500/30 overflow-x-auto",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"DEBUG DASHBOARD (Suporte Fantini)"}),(0,a.jsxs)("p",{children:["M\xeas Selecionado: ",f||"Todos"," (Ano: ",v,", M\xeas Index: ",N,")"]}),(0,a.jsxs)("p",{children:["Total Pedidos (Todos): ",s.length]}),(0,a.jsxs)("p",{children:["Pedidos Filtrados: ",E.length]}),(0,a.jsx)("hr",{className:"border-green-500/30 my-2"}),(0,a.jsx)("p",{children:"Amostra de Pedidos (Primeiros 5):"}),(0,a.jsx)("pre",{children:JSON.stringify(s.slice(0,5).map(e=>({id:e.id,dataOriginal:e.data,dataParsed:new Date(e.data).toLocaleString(),mesIdentificado:new Date(e.data).getMonth()})),null,2)})]})]})}},83779:function(e,t,s){"use strict";s.d(t,{H:function(){return o},a:function(){return n}});var a=s(3827),r=s(64090),i=s(47907);let l=(0,r.createContext)(null);function o(e){let{children:t}=e,[s,o]=(0,r.useState)(null),[n,c]=(0,r.useState)(!0),d=(0,i.useRouter)();(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me");if(e.ok){let t=await e.json();o(t.usuario)}}catch(e){console.error("Auth check failed:",e)}finally{c(!1)}})()},[]);let x=async(e,t)=>{try{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({identifier:e,senha:t})}),a=await s.json();if(s.ok)return o(a.usuario),{success:!0};return{success:!1,error:a.error||"Erro ao fazer login"}}catch(e){return{success:!1,error:"Erro de conex\xe3o"}}},m=async()=>{try{await fetch("/api/auth/me",{method:"DELETE"})}catch(e){console.error("Logout error:",e)}finally{o(null),d.push("/")}};return(0,a.jsx)(l.Provider,{value:{usuario:s,loading:n,login:x,logout:m,isAdmin:(null==s?void 0:s.role)==="admin"},children:t})}function n(){let e=(0,r.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},5590:function(e,t,s){"use strict";s.d(t,{F:function(){return h},e:function(){return u}});var a=s(3827),r=s(64090),i=s(46578),l=s(98998),o=s(28814),n=s(52235),c=s(28745),d=s(38371);function x(e){let{message:t,type:s,isVisible:x=!0,onClose:m}=e;return(0,r.useEffect)(()=>{if(x){let e=setTimeout(()=>{m()},3e3);return()=>clearTimeout(e)}},[x,m]),(0,a.jsx)(c.M,{children:x&&(0,a.jsxs)(d.E.div,{initial:{opacity:0,y:50,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.9},className:"fixed bottom-6 right-6 z-50 flex items-center gap-3 rounded-xl border border-white/10 bg-black/80 px-4 py-3 text-sm text-white shadow-2xl backdrop-blur-md",children:[(0,a.jsxs)("div",{className:"rounded-full p-1 ".concat("success"===s?"bg-green-500/20 text-green-500":"error"===s?"bg-red-500/20 text-red-500":"bg-blue-500/20 text-blue-500"),children:["success"===s&&(0,a.jsx)(i.Z,{className:"h-4 w-4"}),"error"===s&&(0,a.jsx)(l.Z,{className:"h-4 w-4"}),"info"===s&&(0,a.jsx)(o.Z,{className:"h-4 w-4"})]}),(0,a.jsx)("span",{className:"font-medium pr-2",children:t}),(0,a.jsx)("button",{onClick:m,className:"ml-2 rounded-lg p-1 text-gray-400 hover:bg-white/10 hover:text-white transition-colors",children:(0,a.jsx)(n.Z,{className:"h-3 w-3"})})]})})}let m=(0,r.createContext)(void 0);function h(e){let{children:t}=e,[s,i]=(0,r.useState)([]),[l,o]=(0,r.useState)([]),[n,c]=(0,r.useState)([]),[d,h]=(0,r.useState)([]),[u,p]=(0,r.useState)(!0),[g,f]=(0,r.useState)(null),[b,j]=(0,r.useState)(null),w=(0,r.useCallback)((e,t)=>{j({message:e,type:t})},[]),y=(0,r.useCallback)(async()=>{p(!0);try{let[e,t,s,a]=await Promise.all([fetch("/api/clients"),fetch("/api/products"),fetch("/api/orders"),fetch("/api/fabricas")]);e.ok&&i(await e.json()),t.ok&&o(await t.json()),s.ok&&c(await s.json()),a.ok&&h(await a.json())}catch(e){console.error("Error fetching data:",e),w("Erro ao carregar dados","error")}finally{p(!1)}},[w]);(0,r.useEffect)(()=>{y();let e=localStorage.getItem("frplus_user");e&&f(e)},[y]);let v=async e=>{try{let t=await fetch("/api/clients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let e=await t.json();i(t=>[...t,e]),w("Cliente cadastrado com sucesso!","success")}else w("Erro ao cadastrar cliente","error")}catch(e){console.error("Error adding client:",e),w("Erro ao cadastrar cliente","error")}},N=async(e,t)=>{try{let s=await fetch("/api/clients/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(s.ok){let t=await s.json();i(s=>s.map(s=>s.id===e?t:s)),w("Cliente atualizado com sucesso!","success")}}catch(e){console.error("Error updating client:",e),w("Erro ao atualizar cliente","error")}},E=async e=>{try{(await fetch("/api/clients/".concat(e),{method:"DELETE"})).ok&&(i(t=>t.filter(t=>t.id!==e)),w("Cliente exclu\xeddo com sucesso!","success"))}catch(e){console.error("Error removing client:",e),w("Erro ao excluir cliente","error")}},S=async e=>{try{(await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok?(await y(),w("Produto cadastrado com sucesso!","success")):w("Erro ao cadastrar produto","error")}catch(e){console.error("Error adding product:",e),w("Erro ao cadastrar produto","error")}},D=async(e,t)=>{try{(await fetch("/api/products/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(await y(),w("Produto atualizado com sucesso!","success"))}catch(e){console.error("Error updating product:",e),w("Erro ao atualizar produto","error")}},k=async e=>{try{(await fetch("/api/products/".concat(e),{method:"DELETE"})).ok&&(o(t=>t.filter(t=>t.id!==e)),w("Produto exclu\xeddo com sucesso!","success"))}catch(e){console.error("Error removing product:",e),w("Erro ao excluir produto","error")}},C=async e=>{try{(await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok?(await y(),w("Pedido cadastrado com sucesso!","success")):w("Erro ao cadastrar pedido","error")}catch(e){console.error("Error adding order:",e),w("Erro ao cadastrar pedido","error")}},T=async(e,t)=>{try{(await fetch("/api/orders/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(await y(),w("Pedido atualizado com sucesso!","success"))}catch(e){console.error("Error updating order:",e),w("Erro ao atualizar pedido","error")}},P=async e=>{try{(await fetch("/api/orders/".concat(e),{method:"DELETE"})).ok&&(c(t=>t.filter(t=>t.id!==e)),w("Pedido exclu\xeddo com sucesso!","success"))}catch(e){console.error("Error removing order:",e),w("Erro ao excluir pedido","error")}},O=async e=>{try{let t=await fetch("/api/fabricas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let e=await t.json();h(t=>[...t,e]),w("F\xe1brica cadastrada com sucesso!","success")}}catch(e){console.error("Error adding fabrica:",e),w("Erro ao cadastrar f\xe1brica","error")}},I=async(e,t)=>{try{(await fetch("/api/fabricas/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(await y(),w("F\xe1brica atualizada com sucesso!","success"))}catch(e){console.error("Error updating fabrica:",e),w("Erro ao atualizar f\xe1brica","error")}},Z=async e=>{try{(await fetch("/api/fabricas/".concat(e),{method:"DELETE"})).ok&&(h(t=>t.filter(t=>t.id!==e)),w("F\xe1brica exclu\xedda com sucesso!","success"))}catch(e){console.error("Error removing fabrica:",e),w("Erro ao excluir f\xe1brica","error")}};return(0,a.jsxs)(m.Provider,{value:{clients:s,products:l,orders:n,fabricas:d,loading:u,addClient:v,updateClient:N,removeClient:E,addProduct:S,updateProduct:D,removeProduct:k,addOrder:C,updateOrder:T,removeOrder:P,addFabrica:O,updateFabrica:I,removeFabrica:Z,getDashboardStats:()=>({totalSales:n.reduce((e,t)=>e+t.valorTotal,0),totalOrders:n.length,newClients:s.length,totalProducts:l.length}),showToast:w,user:g,login:e=>{f(e),localStorage.setItem("frplus_user",e)},logout:()=>{f(null),localStorage.removeItem("frplus_user")},refreshData:y},children:[t,b&&(0,a.jsx)(x,{message:b.message,type:b.type,onClose:()=>j(null)})]})}function u(){let e=(0,r.useContext)(m);if(void 0===e)throw Error("useData must be used within a DataProvider");return e}}},function(e){e.O(0,[462,792,661,971,69,744],function(){return e(e.s=46201)}),_N_E=e.O()}]);